<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>DLMtool: Data-Limited Methods Toolkit (v3.11). DLMtool Documentation</title><!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous"><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <div class="container">
      <header><div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">DLMtool Documentation</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Operating Model
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../reference/OM_Input/index.html">OM Input</a>
    </li>
    <li>
      <a href="../reference/OM_Setup/index.html">OM Setup</a>
    </li>
    <li>
      <a href="../reference/Run_MSE/index.html">Run MSE</a>
    </li>
  </ul></li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Management Procedures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../reference/Output_Controls/index.html">Output Controls</a>
    </li>
    <li>
      <a href="../reference/Input_Controls/index.html">Input Controls</a>
    </li>
    <li>
      <a href="../reference/Reference_Methods/index.html">Reference Methods</a>
    </li>
  </ul></li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    R Objects
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li class="dropdown-header">MSE Object</li>
    <li>
      <a href="../reference/MSE_Plots/index.html">Plotting Functions</a>
    </li>
    <li>
      <a href="../reference/MSE_Functions/index.html">MSE Object Functions</a>
    </li>
    <li class="dropdown-header">Data Object</li>
    <li>
      <a href="../reference/Available_Methods/index.html">Available Methods</a>
    </li>
    <li>
      <a href="../reference/Apply_MP/index.html">Apply Methods</a>
    </li>
    <li>
      <a href="../reference/Data_Plots/index.html">Plotting Functions</a>
    </li>
  </ul></li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../reference/Class/index.html">Object Classes</a>
    </li>
    <li>
      <a href="../reference/Estimation_Methods/index.html">Estimation Methods</a>
    </li>
    <li>
      <a href="../reference/Handy_Functions/index.html">Handy Functions</a>
    </li>
    <li>
      <a href="../reference/Other/index.html">Other</a>
    </li>
  </ul></li>
<li>
  <a href="../userguide/index.html">User Guide</a>
</li>
<li>
  <a href="http://www.datalimitedtoolkit.org/">DLMtool Website</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>DLMtool: Data-Limited Methods Toolkit (v3.11)</h1>
                        <h4 class="author">Tom Carruthers (<a href="mailto:t.carruthers@fisheries.ubc.ca">t.carruthers@fisheries.ubc.ca</a>) and Adrian Hordyk (<a href="mailto:a.hordyk@murdoch.edu.au">a.hordyk@murdoch.edu.au</a>)</h4>
            
            <h4 class="date">2016-11-01</h4>
          </div>

    
    
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>As many as 90 per cent of the world&rsquo;s fish populations have insufficient data to conduct a conventional stock assessment (Costello et al. 2012). Although a wide range of data-limited management procedures (MPs; stock assessments, harvest control rules) have been described in the primary and gray literature (Newman et al. 2014), these are not readily available, easily tested or compared. Critically, the path forward is unclear. How do these MPs perform comparatively? What are the performance trade-offs? What MPs are inappropriate for given stock/fishery/data quality? What is the value of collecting additional data? What is an appropriate stop-gap management approach?</p>
<p>DLMtool is a collaboration between the University of British Columbia and the Natural Resources Defense Council aimed at addressing these questions by offering a powerful, transparent approach to selecting and applying various data-limited MPs. DLMtool uses Management Strategy Evaluation (MSE, closed-loop simulation) and parallel computing to make powerful diagnostics accessible. A streamlined command structure and operating model builder allow for rapid simulation testing and graphing of results. The package is relatively easy to use for those inexperienced in R, however complete access and control is available to more experienced users.</p>
<p>While DLMtool includes over 55 MPs (e.g.&nbsp;DCAC, DBSRA), it is also designed to be extensible in order to encourage the development and testing of new MPs for informing management of data-limited fish stocks. The package is structured such that the same MP functions that are tested by MSE can be applied to provide management recommendations from real data. Easy incorporation of real data is central advantage of the software and a set of related functions automatically detect what MP can be applied given the available data and what additional data are required to get other MPs working.</p>
<p>DLMtool has been used in setting catch-limits at the Mid-Atlantic Fishery Management Council (US) and is being used to test management procedures in California state fisheries (California Department of Fish and Wildlife), the Caribbean (NOAA), and for seafood certification purposes (MSC).</p>
</div>
<div id="version-notes" class="section level1">
<h1>Version Notes</h1>
<p>The package is subject to ongoing testing. Once again, if you find a bug or a problem please send a report to <a href="mailto:t.carruthers@fisheries.ubc.ca">t.carruthers@fisheries.ubc.ca</a> or <a href="mailto:a.hordyk@murdoch.edu.au">a.hordyk@murdoch.edu.au</a> so that it can be fixed!</p>
<div id="new-additions-to-this-version-3.2.2" class="section level2">
<h2>New Additions to this Version (3.2.2)</h2>
<p>A number of additional plotting functions, and a few new MPs have been added in this version. Also a few minor changes to improve performance and reliability of the model.</p>
<p>For improved stability, especially with large files, the <code>runMSErobust</code> function has been changed so that it now uses the <code>saveRDS</code> function to write the MSE objects to disk. MSE objects saved with this version of the function need to be loaded with <code>readRDS</code>.</p>
<div id="new-functions" class="section level3">
<h3>New Functions</h3>
<p><code>plotFun</code> function can be used to print out all available plotting functions for objects of class <code>MSE</code> or <code>DLM_data</code></p>
<p><strong>MSE Object</strong></p>
<p>Pplot and Kplot functions have been modified for extra control of various features of the plots.</p>
<p>Two functions, <code>barplot.MSE</code> and <code>boxplot.MSE</code>, have been added to plot the MSE object. Call them using the generic <code>barplot</code> or <code>boxplot</code> functions, and see <code>?barplot.MSE</code> and <code>?boxplot.MSE</code> for information on the arguments for the function.</p>
<p>New functions: <code>Jplot</code>, <code>Splot</code>, <code>Cplot</code>, and <code>VOIplot</code> added.</p>
<p><strong>DLM_data Object</strong></p>
<p><code>boxplot.DLM_data</code> has been added and can be used to plot boxplots of the TACs recommendations from different methods. Call with <code>boxplot(DLM_data)</code></p>
<p><strong>New MPs</strong></p>
<p>Three new input control methods, developed by Helena Geremont, have been added to the package: <code>EtargetLopt</code>, <code>L95target</code>, and <code>minlenLopt1</code>.</p>
</div>
<div id="coming-soon" class="section level3">
<h3>Coming Soon!</h3>
<p>A user manual for the DLMtool is currently being developed and should be available soon (hopefully!)</p>
</div>
</div>
<div id="new-additions-to-version-3.2.1" class="section level2">
<h2>New Additions to Version 3.2.1</h2>
<p>A new slot (Effort) has been added to the MSC object. This stores the fishing effort for each year, simulation, and MP in the projection years. The addition of the new slot may cause a warning message to be thrown up if a MSE object from a previous version of the DLMtool is loaded.</p>
<p>You can update the old MSE object by adding an empty <code>Effort</code> slot: <code>MSEobj &lt;- updateMSE(MSEobj)</code></p>
<p>There were some issues with a couple of the input control MPs, which have now been addressed (thanks Helena for identifying these). There was also a problem with how effort and selectivity was being calculated for the input controls.</p>
</div>
<div id="new-additions-to-version-3.2" class="section level2">
<h2>New Additions to Version 3.2</h2>
<p>A number of small but important bugs have been fixed, with special thanks to Liz Brooks, Helena Geromont, and Bill Harford, for alerting us to some of these issues.</p>
<p>Quang Huynh has recoded the mean length methods in C++, and they now run much faster, and should pass the timelimit constraint.</p>
<p>A new function (<code>runMSErobust</code>) has been added which is a wrapper for the <code>runMSE</code> function. In time this may replace <code>runMSE</code> as the primary function to use when running a MSE. <code>runMSErobust</code> splits large simulations into a series of smaller packets and stitches them together to return a MSE object. This has the benefit of increasing speed and efficiency, particularly for runs with large number of simulations. The function also checks for errors and re-starts the MSE if the model crash.</p>
<p>A set of functions <code>OM_xl</code> and <code>Fease_xl</code> have been added. These are used to read in operating model and feasibility parameters from a Excel spreadsheet rather than CSVs. These are essentially wrappers for the <code>new</code> function, but allow you store all operating model tables in a single spreadsheet rather than a whole lot of CSVs. Mainly useful if you are working on multiple species/stocks.</p>
<p>The size limit feature has been updated to include an upper slot limit. See <code>slotlim</code> for an example MP. The slot limit is specified as the last element in the input control vector. Similar to the lower size limit, all individuals above the slot limit experience no fishing mortality.</p>
<p>A number of new MPs have been added. There are now 63 output and 22 input control MPs in the DLMtool.</p>
<p>A new function <code>makePerf</code> has been added. This function takes an OM object, and returns the same OM object with no process or observation error. Useful for testing the performance of methods under perfect conditions, to see if work as expected. And for debugging!</p>
<p>Two new plotting functions: <code>wormplot</code> which creates worm plots of the likelihood of meeting biomass targets in future years and <code>VOIplot</code> which is another value of information plot, similar to the <code>VOI</code> function, and shows how observation and operating model parameter values affect trends in long-term yield and biomass.</p>
<p>Coming soon: bag limit MPs for recreational fisheries</p>
</div>
<div id="notes-from-version-3.1" class="section level2">
<h2>Notes from version 3.1</h2>
<p>Variable historical selectivity patterns. In order to simulate fisheries that have experienced important shifts in historical length selectivity, this can now be user specified using a graphical user interface (the &lsquo;ChooseSelect&rsquo; function) or by manually editing a series of new slots in the Fleet object (<code>SelYears</code>, <code>AbsSelYears</code>, <code>L5Upper</code>, <code>L5Lower</code>, <code>LFSUpper</code>, <code>LFSLower</code>, <code>VmaxUpper</code>, <code>VmaxLower</code>).</p>
<p>Cyclic Recruitment patterns. Persistent shifts in stock productivity are a particular concern for fishery management. These can now be generated in the toolkit using a new function <code>SetRecruitCycle</code> that generates cyclical pattern in recruitment strength.</p>
<p>Length-based spawning potential ratio (SPR) MPs.</p>
<p>Two features have been added to allow MPs to return additional information for future reference and use that information in the future. (1) The DLM_data object that MPs operate on now has a miscellaneous slot <code>Misc</code>. (2) MPs can now return a list. The first position is the management recommendation (e.g.&nbsp;TAC) the second is information that is stored in the <code>Misc</code> slot that can be used by the MP in the next iteration.</p>
<p>A new generic trade-off performance plot <code>TradePlot</code>.</p>
</div>
<div id="a-note-on-version-2.11" class="section level2">
<h2>A note on version 2.11</h2>
<p>Operating model effort is now simulated by a time-series of year vertices and relative magnitude of effort at each vertex. It follows that the slot <code>Fleet@Fgrad</code> is no longer, and has been replaced by three slots with vectors of equal length: <code>Fleet@EffYear</code>, <code>Fleet@EffUpper</code> and <code>Fleet@EffLower</code>.</p>
<p>These effort trajectories can now be specified by a new graphical interface (function <code><a href="../reference/ChooseEffort.html">ChooseEffort()</a></code>) which uses points to determine the three slots described above.</p>
<p>Operating model fleet selectivity has been robustified to prevent users from specifying length at first capture (<code>Fleet@L5</code>) and length at full selection (<code>Fleet@LFS</code>) that are unrealistically high. According to our view of reality these now have upper limits of L50 and maximum length, respectively.</p>
<p>A function <code><a href="../reference/DOM.html">DOM()</a></code> has been added that evaluates how often one MP outperforms another across simulations. It is possible that an MP could have higher average performance but perform worse on higher fraction of simulations. The <code><a href="../reference/DOM.html">DOM()</a></code> function provides a diagnostic.</p>
<p>An additional function <code><a href="../reference/Sub.html">Sub()</a></code> has been added which allows users to subset an MSE object according to either (or both) a vector of MPs and simulations. This means you no longer have to rerun everything to provide results for a smaller number of MPs or particular simulations.</p>
</div>
<div id="a-note-on-bug-fixes-in-2.1.1-and-2.1.2" class="section level2">
<h2>A note on bug fixes in 2.1.1 and 2.1.2</h2>
<p>A bug was found in which length at first capture was being sampled from a uniform distribution <code>U(LB,UB*2)</code> rather than <code>U(LB,UB)</code>. When depletion could not be simulated by even very high fishery catchabilities an error could occur after more than 10 attempts to find a suitable value of depletion. Length composition simulation in 2.1.1 was not correctly implemented leading to minor biases.</p>
</div>
<div id="a-note-on-version-2.1" class="section level2">
<h2>A note on version 2.1</h2>
<p>The package has overgone a substantial overhaul. In response to popular demand, simulation and data are entirely length-based now. It follows that many objects that worked with 2.0 will no longer be compatible. In most cases it is very quick to make files/objects compatible with version 2.1 but nonetheless we apologise if this is frustrating!</p>
<p>Fundamentally the package is stochastic so if you run into problems with the code, please report it (along with a random seed) and in the mean time simply try running it again: the problem may be attributable to a rare combination of sampled parameters.</p>
<p>Be warned that if you abort a parallel process (e.g. <code><a href="../reference/runMSE.html">runMSE()</a></code>) half-way through you are in the lap of the Gods! It will often be necessary to restart the cluster <code>sfInit()</code> or even restart R.</p>
<p>Its probably best not to try and use the package for very short lived stocks (that live for less than 5 years) due to the problems with approximating fine-scale temporal dynamics with an annual model. Technically you could just divide all your parameters by a subyear resolution but the TAC would be set by sub year and the data would also be available at this fine-scale which is highly unlikely in a data-limited setting.</p>
</div>
<div id="new-to-version-2.1" class="section level2">
<h2>New to version 2.1</h2>
<ol style="list-style-type: decimal"><li><p>The whole toolkit has moved to a length-based simulator (maturity, fisheries selectivity by length)</p></li>
<li><p>We&rsquo;ve dropped spatial targeting for the moment as it was a flawed implementation and could not distribute fishing correctly with respect to both density and amount of resource among the two areas.</p></li>
<li><p><code>Tplot2</code> adds a different set of trade-offs including long term and short term probability of achieving 50 per cent of FMSY yield and average annual variability in yields</p></li>
<li><p>Version 2.0 was bugged and did not include observation error in estimates of current stock abundance and depletion (only biases were simulated). Many thanks to Helena Geromont for spotting this. This has now been corrected</p></li>
<li><p>DLM_data objects now have a slot LHYear which is a numeric value corresponding with the last historical year. This is needed for some MPs that want to run off only the past data rather than the updated (projected, closed-loop simulation) data.</p></li>
<li><p>Post-MSE you can now run a Convergence function <code><a href="../reference/CheckConverg.html">CheckConverg()</a></code> to see if performance metrics are stable.</p></li>
<li><p>The package now contains <code>CSRA</code> a tool for calculating very rough estimates of current depletion and fishing mortality rate from mean catch data.</p></li>
<li><p><code>getAFC</code> is also available that can be used for converting length estimates to age estimates through a stochastic growth model.</p></li>
<li><p>The value of information function (<code>VOI</code>) was bugged in version 2.0. This has now been fixed.</p></li>
<li><p>Users can now send their own parameter values to the <code>runMSE</code> function allowing outputs from stock assessments or correlated parameters (e.g. <em>K</em> and age at maturity) values.</p></li>
<li><p>After deliberation, Pope&rsquo;s approximation has been used to account for intra-year mortality (ie TACs are taken from biomass at the start of the year subject to half of natural mortality rate). This is probably a reasonable approximation in a data-limited setting: alternative structural assumptions for <em>M</em> are eclipsed by uncertainty in <em>M</em> itself and other operating model parameters such as selectivity and bias in observation of data such as annual catches.</p></li>
<li><p>The simulation of length composition data was bugged in version 2.0. The variability in length at age was taken from the observation model. Using the perfect information observation model therefore led to no variability in length at age and hence very odd length composition data. This has been solved and for now a fixed 10 per cent CV in length at age is assumed (normally distributed).</p></li>
<li><p>A bug with delay-difference MPs has been fixed (<code>DD</code> and <code>DD4010</code>) in which stochastic TACs were sampled when reps =1. This should just be the mean estimate. The result is that DD is much less variable between years but comes with less contrast in the data. In addition to the much less variable catch recommendations, long term mean performance of the MP is reduced while medium term performance has been improved.</p></li>
<li><p>In the move to length-based inputs it is possible to prescribe wild biases for maximum length and length at maturity. In this version these sampled biases are not correlated so it is possible to create simulated data sets where maximum length is lower than length at 95 percent maturity and length at 50 per cent maturity. We put a hard ceiling on this such that length at 95 percent maturity must be below 90 percent of maximum length and length at 50 percent maturity must be below 90 percent of length at 95 percent maturity. This isn&rsquo;t great and this will be improved for v2.11</p></li>
<li><p>The package now works without initiating a cluster <code>sfInit()</code>.</p></li>
<li><p>A simple modification to <code>DCAC</code> has been added <code>EDCAC</code> (Harford and Carruthers 2015) that better accounts for absolute stock depletion.</p></li>
<li><p>Three new slots are available to run MPs on that related to mean length of catches (ML), modal length of captures (Lc), and the mean length of catches of fish over Lc (Lbar)</p></li>
</ol></div>
<div id="new-to-version-2.0" class="section level2">
<h2>New to version 2.0</h2>
<ol style="list-style-type: decimal"><li><p>Much has changed in package terminology to make the package more generally applicable. For example, OFL (overfishing limits, FMSY x current biomass), now belongs to a larger class of TACs (Total Allowable Catches).</p></li>
<li><p>There are now just two classes of DLM MPs, DLM_output (MPs linked to output controls e.g.&nbsp;TACs) and DLM_input (MPs linked to input controls such as time-area closures, age selectivity and effort). The new DLM_input function classes have four components, fractional reallocation of spatial effort, fraction of effort in final historical year prescribed in the current year, spatial limits on fishing mortality and a user-defined age-selectivity curve. For example, given an hypothetical stock with 8 age classes a DLM_input method might return a vector c(0.5, 0.8, 0,1, 0,0,0,0,1,1,1,1). This is interpreted as a 50 percent reallocation (Allocation = 0.5) of spatial effort, with a total effort that is 80 percent of historical levels (Effort = 0.8) with a closure in area 1 and full fishing in area 2 (Spatial = c(0,1)) and knife-edge selectivity at age class 5 (Selectivity = c(0,0,0,0,1,1,1,1)) [note that Selectivity has changed in newer versions of the package]. To demonstrate this new feature there are four new input controls, current effort (curE), 75 percent of current effort (curE75), age selectivity that matches the maturity ogive (matagelim) and a marine reserve in area 1 (area1MR) [note that matagelim has changed to matlenlim in recent versions].</p></li>
<li><p>A &lsquo;dumb&rsquo; MP has been added: Mean Catch Depletion (MCD) that simply calculates a TAC based on mean catches and depletion ie depletion x 2 x mean catch. This is to demonstrate the (theoretically) very high information content of a reliable estimate of current stock depletion.</p></li>
<li><p>A better length composition simulator has been added. Note that this still renews the normal length structure between ages and does not properly simulate the higher mortality rate of larger, faster growing fish (a growth type group simulator is on its way).</p></li>
<li><p>Help documentation has been much improved including complete guides for <code>Fleet</code>, <code>Stock</code>, <code>Observation</code> and <code>MSE</code> objects. Eg <code>class?MSE</code></p></li>
<li><p>Minor bugs have been found with the help of Helena Geromont including a problem with update intervals of 1 and low simulated steepness values.</p></li>
<li><p>Reliability is much improved following a full combinatorial test of all Fleet, Stock, Observation objects against all MPs.</p></li>
<li><p>A dedicated Value of information function is now available for MSE objects: <code><a href="../reference/VOI.html">VOI(MSEobject)</a></code> which is smarter than the former version which was included in plot(MSE object class).</p></li>
<li><p>Plotting functions have been improved, particularly <code>Tplot</code>, <code>Kplot</code>, <code>Pplot</code> and <code>plot(DLM_data object class)</code></p></li>
<li><p><code>SPmod</code> has been robustified to stop strongly negative surplus production estimates from leading to erratic behavior.</p></li>
<li><p>The butterfish stock type now has less variable recruitment and slightly lower natural mortality rate as previous values were rather extreme and lead to data generation errors (with natural mortality rate as high as 0.9, butterfish is right at the limit of what can be simulated reasonably with an annual age-structured operating model)</p></li>
</ol></div>
<div id="coming-soon-to-v3.02" class="section level2">
<h2>Coming soon to v3.02</h2>
<p>Worm plots (likelihood of obtaining biomass reference levels)</p>
<p>Data-rich assessment MPs (for comparison)</p>
</div>
</div>
<div id="prerequisites" class="section level1">
<h1>Prerequisites</h1>
<p>At the start of every session there are a few things to do: load the DLMtool library, make data available and set up parallel computing.</p>
<div id="loading-the-library" class="section level2">
<h2>Loading the library</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(DLMtool)</code></pre></div>
</div>
<div id="unpacking-the-data" class="section level2">
<h2>Unpacking the data</h2>
<p>A list object DLMdat is unpacked which puts all objects and data in the current workspace.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">for(i in <span class="dv">1</span>:<span class="kw">length</span>(DLMdat))<span class="kw">assign</span>(DLMdat[[i]]@Name,DLMdat[[i]])</code></pre></div>
<div id="initiating-the-cluster" class="section level3">
<h3>Initiating the cluster</h3>
<p>Note that most computers make use of hyperthreading technology so a quad-core PC has 8 threads, this is set to 2 here to meet CRAN-R package submission requirements.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sfInit</span>(<span class="dt">parallel=</span><span class="ot">TRUE</span>, <span class="dt">cpus=</span><span class="dv">2</span>) </code></pre></div>
<p>You can automatically detect the number of threads using <code>detectCores()</code>. Ie type <code>sfInit(parallel=T,detectCores())</code>.</p>
</div>
</div>
<div id="exporting-all-data-and-objects-to-the-cluster" class="section level2">
<h2>Exporting all data and objects to the cluster</h2>
<p>In order to make all DLMtool functions and objects available for parallel processing we export them to the cluster.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sfExportAll</span>()</code></pre></div>
</div>
<div id="set-a-random-seed" class="section level2">
<h2>Set a random seed</h2>
<p>In order to make results presented here reproducible, we set a random seed for this R session.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1</span>) </code></pre></div>
</div>
</div>
<div id="quick-start" class="section level1">
<h1>Quick start</h1>
<p>Here is a quick demonstration of core DLMtool functionality.</p>
<div id="define-an-operating-model" class="section level2">
<h2>Define an operating model</h2>
<p>The operating model is the &lsquo;simulated reality&rsquo;: a series of known simulations for testing various data-limited MPs. Operating models can either be specified in detail according to each variable (e.g.&nbsp;sample natural mortality rate between 0.2 and 0.3) or alternatively the user can rapidly construct an operating model based on a set of predefined <code>Stock</code>, <code>Fleet</code> and <code>Observation</code> models. In this case we take the latter approach and pick the <code>Blue\_shark</code> stock type, a Generic fleet type and an observation model that generates data that can be both imprecise and biased.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">OM &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">'OM'</span>, Blue_shark, Generic_fleet, Imprecise_Biased)</code></pre></div>
<p>The operating model class &lsquo;OM&rsquo; has many different slots which control the ranges of population and fleet parameters that may be sampled in addition to parameters that control the quality of the data simulated. You can list these using <code>slotNames()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">slotNames</span>(OM)
<span class="co">#&gt;  [1] "Name"         "nyears"       "maxage"       "R0"          </span>
<span class="co">#&gt;  [5] "M"            "Msd"          "Mgrad"        "h"           </span>
<span class="co">#&gt;  [9] "SRrel"        "Linf"         "K"            "t0"          </span>
<span class="co">#&gt; [13] "Ksd"          "Kgrad"        "Linfsd"       "Linfgrad"    </span>
<span class="co">#&gt; [17] "recgrad"      "a"            "b"            "D"           </span>
<span class="co">#&gt; [21] "Size_area_1"  "Frac_area_1"  "Prob_staying" "Source"      </span>
<span class="co">#&gt; [25] "L50"          "L50_95"       "SelYears"     "AbsSelYears" </span>
<span class="co">#&gt; [29] "L5"           "LFS"          "Vmaxlen"      "L5Lower"     </span>
<span class="co">#&gt; [33] "L5Upper"      "LFSLower"     "LFSUpper"     "VmaxLower"   </span>
<span class="co">#&gt; [37] "VmaxUpper"    "isRel"        "beta"         "Spat_targ"   </span>
<span class="co">#&gt; [41] "Fsd"          "Period"       "Amplitude"    "EffYears"    </span>
<span class="co">#&gt; [45] "EffLower"     "EffUpper"     "qinc"         "qcv"         </span>
<span class="co">#&gt; [49] "AC"           "Cobs"         "Cbiascv"      "CAA_nsamp"   </span>
<span class="co">#&gt; [53] "CAA_ESS"      "CAL_nsamp"    "CAL_ESS"      "CALcv"       </span>
<span class="co">#&gt; [57] "Iobs"         "Perr"         "Mcv"          "Kcv"         </span>
<span class="co">#&gt; [61] "t0cv"         "Linfcv"       "LFCcv"        "LFScv"       </span>
<span class="co">#&gt; [65] "B0cv"         "FMSYcv"       "FMSY_Mcv"     "BMSY_B0cv"   </span>
<span class="co">#&gt; [69] "LenMcv"       "rcv"          "Dbiascv"      "Dcv"         </span>
<span class="co">#&gt; [73] "Btbias"       "Btcv"         "Fcurbiascv"   "Fcurcv"      </span>
<span class="co">#&gt; [77] "hcv"          "Icv"          "maxagecv"     "Reccv"       </span>
<span class="co">#&gt; [81] "Irefcv"       "Crefcv"       "Brefcv"</span></code></pre></div>
<p>or can look up the help file entry:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">class?OM</code></pre></div>
</div>
<div id="define-a-subset-of-data-limited-mps" class="section level2">
<h2>Define a subset of data-limited MPs</h2>
<p>There are three different types of MP currently included in DLMtool: DLM_output (output controls, e.g.&nbsp;a TAC), DLM_input (size/age/spatial controls). In this example we use a generic class finder <code>avail</code> to list all available methods of class &lsquo;DLM_output&rsquo;:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/avail.html">avail</a></span>(<span class="st">'DLM_output'</span>)
<span class="co">#&gt;  [1] "AvC"         "BK"          "BK_CC"       "BK_ML"       "CC1"        </span>
<span class="co">#&gt;  [6] "CC4"         "CompSRA"     "CompSRA4010" "DAAC"        "DBSRA"      </span>
<span class="co">#&gt; [11] "DBSRA_40"    "DBSRA_ML"    "DBSRA4010"   "DCAC"        "DCAC_40"    </span>
<span class="co">#&gt; [16] "DCAC_ML"     "DCAC4010"    "DD"          "DD4010"      "DepF"       </span>
<span class="co">#&gt; [21] "DynF"        "Fadapt"      "Fdem"        "Fdem_CC"     "Fdem_ML"    </span>
<span class="co">#&gt; [26] "FMSYref"     "FMSYref50"   "FMSYref75"   "Fratio"      "Fratio_CC"  </span>
<span class="co">#&gt; [31] "Fratio_ML"   "Fratio4010"  "GB_CC"       "GB_slope"    "GB_target"  </span>
<span class="co">#&gt; [36] "Gcontrol"    "HDAAC"       "Islope1"     "Islope4"     "IT10"       </span>
<span class="co">#&gt; [41] "IT5"         "Itarget1"    "Itarget4"    "ITM"         "L95target"  </span>
<span class="co">#&gt; [46] "LBSPR_ItTAC" "LstepCC1"    "LstepCC4"    "Ltarget1"    "Ltarget4"   </span>
<span class="co">#&gt; [51] "MCD"         "MCD4010"     "NFref"       "Rcontrol"    "Rcontrol2"  </span>
<span class="co">#&gt; [56] "SBT1"        "SBT2"        "SPmod"       "SPMSY"       "SPslope"    </span>
<span class="co">#&gt; [61] "SPSRA"       "SPSRA_ML"    "VPA"         "YPR"         "YPR_CC"     </span>
<span class="co">#&gt; [66] "YPR_ML"</span></code></pre></div>
<p>and select some for simulation testing:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MPs &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"Fratio"</span>, <span class="st">"DCAC"</span>, <span class="st">"Fdem"</span>, <span class="st">"DD"</span>)    </code></pre></div>
<p>To find out more about these MPs you can use the built-in R help functions. E.g:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">?Fratio
?DBSRA</code></pre></div>
<p>Or simply view the code. E.g:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Fratio
<span class="co">#&gt; function (x, DLM_data, reps = 100) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     depends = "DLM_data@Abun,DLM_data@CV_Abun,DLM_data@FMSY_M, DLM_data@CV_FMSY_M,DLM_data@Mort,DLM_data@CV_Mort"</span>
<span class="co">#&gt;     Ac &lt;- trlnorm(reps, DLM_data@Abun[x], DLM_data@CV_Abun[x])</span>
<span class="co">#&gt;     TACfilter(Ac * trlnorm(reps, DLM_data@Mort[x], DLM_data@CV_Mort[x]) * </span>
<span class="co">#&gt;         trlnorm(reps, DLM_data@FMSY_M[x], DLM_data@CV_FMSY_M[x]))</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; &lt;environment: namespace:DLMtool&gt;</span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "DLM_output"</span></code></pre></div>
</div>
<div id="run-an-mse-and-plot-results" class="section level2">
<h2>Run an MSE and plot results</h2>
<p>The MPs can now be tested using the operating model. NOTE that this is just a demonstration, in a real MSE you should use many more simulations (<code>nsim</code> more than 200), <code>reps</code> (samples per method more than 100) and perhaps a more frequent assessment interval (<code>interval</code> of 2 or 3 years). Note that when <code>reps</code> is set to 1, all stochastic MPs use the mean value of an input and do not sample from the distribution according to the specified CV (the DLM_output MPs become deterministic and no longer produce samples of the TAC recommendation).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">SnapMSE &lt;-<span class="st"> </span><span class="kw"><a href="../reference/runMSE.html">runMSE</a></span>(OM, MPs, <span class="dt">nsim=</span><span class="dv">16</span>, <span class="dt">reps=</span><span class="dv">1</span>, <span class="dt">proyears=</span><span class="dv">30</span>, <span class="dt">interval=</span><span class="dv">10</span>)</code></pre></div>
<p>The generic plot method provides (1) overfishing trajectories (2) Kobe plots and (3) trade-off plots of expected (mean) performance of the MPs in terms of stock status, overfishing and yield.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(SnapMSE)</code></pre></div>
<p><img src="DLMtool_files/figure-html/unnamed-chunk-9-1.png" width="672"><img src="DLMtool_files/figure-html/unnamed-chunk-9-2.png" width="672"><img src="DLMtool_files/figure-html/unnamed-chunk-9-3.png" width="672"></p>
<p>You can access these plots individually: trade-offs - <code><a href="../reference/Tplot.html">Tplot()</a></code>, overfishing trajectories - <code><a href="../reference/Pplot.html">Pplot()</a></code> and Kobe plots - <code><a href="../reference/Kplot.html">Kplot()</a></code></p>
</div>
<div id="applying-mps-to-real-data" class="section level2">
<h2>Applying MPs to real data</h2>
<p>A number of real DLM data-objects (class DLM_data) were loaded into the workspace at the start of this session. In this section we examine a real data object and apply data-limited MPs to these data. Just like the operating model we can find all the objects of real data class <code>DLM\_data</code>:,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/avail.html">avail</a></span>(<span class="st">'DLM_data'</span>)
<span class="co">#&gt; [1] "ourReefFish"</span></code></pre></div>
<p>we can list the slots of a DLM_data object:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">slotNames</span>(China_rockfish)
<span class="co">#&gt;  [1] "Name"       "Year"       "Cat"        "Ind"        "Rec"       </span>
<span class="co">#&gt;  [6] "t"          "AvC"        "Dt"         "Mort"       "FMSY_M"    </span>
<span class="co">#&gt; [11] "BMSY_B0"    "Cref"       "Bref"       "Iref"       "L50"       </span>
<span class="co">#&gt; [16] "L95"        "LFC"        "LFS"        "CAA"        "Dep"       </span>
<span class="co">#&gt; [21] "Abun"       "vbK"        "vbLinf"     "vbt0"       "wla"       </span>
<span class="co">#&gt; [26] "wlb"        "steep"      "CV_Cat"     "CV_Dt"      "CV_AvC"    </span>
<span class="co">#&gt; [31] "CV_Ind"     "CV_Mort"    "CV_FMSY_M"  "CV_BMSY_B0" "CV_Cref"   </span>
<span class="co">#&gt; [36] "CV_Bref"    "CV_Iref"    "CV_Rec"     "CV_Dep"     "CV_Abun"   </span>
<span class="co">#&gt; [41] "CV_vbK"     "CV_vbLinf"  "CV_vbt0"    "CV_L50"     "CV_LFC"    </span>
<span class="co">#&gt; [46] "CV_LFS"     "CV_wla"     "CV_wlb"     "CV_steep"   "sigmaL"    </span>
<span class="co">#&gt; [51] "MaxAge"     "Units"      "Ref"        "Ref_type"   "Log"       </span>
<span class="co">#&gt; [56] "params"     "PosMPs"     "MPs"        "OM"         "Obs"       </span>
<span class="co">#&gt; [61] "TAC"        "TACbias"    "Sense"      "CAL_bins"   "CAL"       </span>
<span class="co">#&gt; [66] "MPrec"      "MPeff"      "ML"         "Lbar"       "Lc"        </span>
<span class="co">#&gt; [71] "LHYear"     "Misc"</span></code></pre></div>
<p>and also look up this class in the help file:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">class?DLM_data</code></pre></div>
<p>DLMtool includes functions to interrogate a real data object to see what methods can be applied, those that cannot and also what data are needed to get those methods working:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/Can.html">Can</a></span>(China_rockfish)
<span class="co">#&gt;  [1] "AvC"         "CC1"         "CC4"         "DAAC"        "DCAC"       </span>
<span class="co">#&gt;  [6] "DCAC_40"     "DCAC4010"    "HDAAC"       "NFref"       "curE"       </span>
<span class="co">#&gt; [11] "curE75"      "EtargetLopt" "matlenlim"   "matlenlim2"  "minlenLopt1"</span>
<span class="co">#&gt; [16] "MRnoreal"    "MRreal"</span>
<span class="kw"><a href="../reference/Cant.html">Cant</a></span>(China_rockfish)
<span class="co">#&gt;       [,1]          [,2]                    </span>
<span class="co">#&gt;  [1,] "BK"          "Produced all NA scores"</span>
<span class="co">#&gt;  [2,] "BK_CC"       "Insufficient data"     </span>
<span class="co">#&gt;  [3,] "BK_ML"       "Insufficient data"     </span>
<span class="co">#&gt;  [4,] "CompSRA"     "Insufficient data"     </span>
<span class="co">#&gt;  [5,] "CompSRA4010" "Insufficient data"     </span>
<span class="co">#&gt;  [6,] "DBSRA"       "Produced all NA scores"</span>
<span class="co">#&gt;  [7,] "DBSRA_40"    "Produced all NA scores"</span>
<span class="co">#&gt;  [8,] "DBSRA_ML"    "Produced all NA scores"</span>
<span class="co">#&gt;  [9,] "DBSRA4010"   "Produced all NA scores"</span>
<span class="co">#&gt; [10,] "DCAC_ML"     "Insufficient data"     </span>
<span class="co">#&gt; [11,] "DD"          "Insufficient data"     </span>
<span class="co">#&gt; [12,] "DD4010"      "Insufficient data"     </span>
<span class="co">#&gt; [13,] "DepF"        "Produced all NA scores"</span>
<span class="co">#&gt; [14,] "DynF"        "Insufficient data"     </span>
<span class="co">#&gt; [15,] "Fadapt"      "Insufficient data"     </span>
<span class="co">#&gt; [16,] "Fdem"        "Insufficient data"     </span>
<span class="co">#&gt; [17,] "Fdem_CC"     "Insufficient data"     </span>
<span class="co">#&gt; [18,] "Fdem_ML"     "Insufficient data"     </span>
<span class="co">#&gt; [19,] "FMSYref"     "Insufficient data"     </span>
<span class="co">#&gt; [20,] "FMSYref50"   "Insufficient data"     </span>
<span class="co">#&gt; [21,] "FMSYref75"   "Insufficient data"     </span>
<span class="co">#&gt; [22,] "Fratio"      "Produced all NA scores"</span>
<span class="co">#&gt; [23,] "Fratio_CC"   "Insufficient data"     </span>
<span class="co">#&gt; [24,] "Fratio_ML"   "Insufficient data"     </span>
<span class="co">#&gt; [25,] "Fratio4010"  "Produced all NA scores"</span>
<span class="co">#&gt; [26,] "GB_CC"       "Produced all NA scores"</span>
<span class="co">#&gt; [27,] "GB_slope"    "Insufficient data"     </span>
<span class="co">#&gt; [28,] "GB_target"   "Insufficient data"     </span>
<span class="co">#&gt; [29,] "Gcontrol"    "Insufficient data"     </span>
<span class="co">#&gt; [30,] "Islope1"     "Insufficient data"     </span>
<span class="co">#&gt; [31,] "Islope4"     "Insufficient data"     </span>
<span class="co">#&gt; [32,] "IT10"        "Insufficient data"     </span>
<span class="co">#&gt; [33,] "IT5"         "Insufficient data"     </span>
<span class="co">#&gt; [34,] "Itarget1"    "Insufficient data"     </span>
<span class="co">#&gt; [35,] "Itarget4"    "Insufficient data"     </span>
<span class="co">#&gt; [36,] "ITM"         "Insufficient data"     </span>
<span class="co">#&gt; [37,] "L95target"   "Insufficient data"     </span>
<span class="co">#&gt; [38,] "LBSPR_ItTAC" "Produced all NA scores"</span>
<span class="co">#&gt; [39,] "LstepCC1"    "Insufficient data"     </span>
<span class="co">#&gt; [40,] "LstepCC4"    "Insufficient data"     </span>
<span class="co">#&gt; [41,] "Ltarget1"    "Insufficient data"     </span>
<span class="co">#&gt; [42,] "Ltarget4"    "Insufficient data"     </span>
<span class="co">#&gt; [43,] "MCD"         "Produced all NA scores"</span>
<span class="co">#&gt; [44,] "MCD4010"     "Produced all NA scores"</span>
<span class="co">#&gt; [45,] "Rcontrol"    "Insufficient data"     </span>
<span class="co">#&gt; [46,] "Rcontrol2"   "Insufficient data"     </span>
<span class="co">#&gt; [47,] "SBT1"        "Insufficient data"     </span>
<span class="co">#&gt; [48,] "SBT2"        "Produced all NA scores"</span>
<span class="co">#&gt; [49,] "SPmod"       "Insufficient data"     </span>
<span class="co">#&gt; [50,] "SPMSY"       "Insufficient data"     </span>
<span class="co">#&gt; [51,] "SPslope"     "Insufficient data"     </span>
<span class="co">#&gt; [52,] "SPSRA"       "Insufficient data"     </span>
<span class="co">#&gt; [53,] "SPSRA_ML"    "Insufficient data"     </span>
<span class="co">#&gt; [54,] "VPA"         "Insufficient data"     </span>
<span class="co">#&gt; [55,] "YPR"         "Insufficient data"     </span>
<span class="co">#&gt; [56,] "YPR_CC"      "Insufficient data"     </span>
<span class="co">#&gt; [57,] "YPR_ML"      "Insufficient data"     </span>
<span class="co">#&gt; [58,] "DDe"         "Insufficient data"     </span>
<span class="co">#&gt; [59,] "DDe75"       "Insufficient data"     </span>
<span class="co">#&gt; [60,] "DDes"        "Insufficient data"     </span>
<span class="co">#&gt; [61,] "DTe40"       "Insufficient data"     </span>
<span class="co">#&gt; [62,] "DTe50"       "Insufficient data"     </span>
<span class="co">#&gt; [63,] "ItargetE1"   "Insufficient data"     </span>
<span class="co">#&gt; [64,] "ItargetE4"   "Insufficient data"     </span>
<span class="co">#&gt; [65,] "ITe10"       "Insufficient data"     </span>
<span class="co">#&gt; [66,] "ITe5"        "Insufficient data"     </span>
<span class="co">#&gt; [67,] "LBSPR_ItEff" "Produced all NA scores"</span>
<span class="co">#&gt; [68,] "LBSPR_ItSel" "Produced all NA scores"</span>
<span class="co">#&gt; [69,] "LstepCE1"    "Insufficient data"     </span>
<span class="co">#&gt; [70,] "LstepCE2"    "Insufficient data"     </span>
<span class="co">#&gt; [71,] "LtargetE1"   "Insufficient data"     </span>
<span class="co">#&gt; [72,] "LtargetE4"   "Insufficient data"     </span>
<span class="co">#&gt; [73,] "slotlim"     "Insufficient data"</span>
<span class="kw"><a href="../reference/Needed.html">Needed</a></span>(China_rockfish)
<span class="co">#&gt;  [1] "BK: LFC, Abun, vbK, vbLinf"                                                 </span>
<span class="co">#&gt;  [2] "BK_CC: LFC, CAA, vbK, vbLinf"                                               </span>
<span class="co">#&gt;  [3] "BK_ML: LFC, vbK, vbLinf, CAL"                                               </span>
<span class="co">#&gt;  [4] "CompSRA: L50, LFC, LFS, CAA, vbK, vbLinf, vbt0, wla, wlb, steep, MaxAge"    </span>
<span class="co">#&gt;  [5] "CompSRA4010: L50, LFC, LFS, CAA, vbK, vbLinf, vbt0, wla, wlb, steep, MaxAge"</span>
<span class="co">#&gt;  [6] "DBSRA: L50, Dep, vbK, vbLinf, vbt0"                                         </span>
<span class="co">#&gt;  [7] "DBSRA_40: L50, Dep, vbK, vbLinf, vbt0"                                      </span>
<span class="co">#&gt;  [8] "DBSRA_ML: L50, Dep, vbK, vbLinf, vbt0, CAL"                                 </span>
<span class="co">#&gt;  [9] "DBSRA4010: L50, Dep, vbK, vbLinf, vbt0"                                     </span>
<span class="co">#&gt; [10] "DCAC_ML: vbK, vbLinf, CAL"                                                  </span>
<span class="co">#&gt; [11] "DD: Ind, L50, vbK, vbLinf, vbt0, wla, wlb, MaxAge"                          </span>
<span class="co">#&gt; [12] "DD4010: Ind, L50, vbK, vbLinf, vbt0, wla, wlb, MaxAge"                      </span>
<span class="co">#&gt; [13] "DepF: Dep, Abun"                                                            </span>
<span class="co">#&gt; [14] "DynF: Ind, Abun"                                                            </span>
<span class="co">#&gt; [15] "Fadapt: Ind, Abun"                                                          </span>
<span class="co">#&gt; [16] "Fdem: Abun, vbK, vbLinf, vbt0, wla, wlb, steep, MaxAge"                     </span>
<span class="co">#&gt; [17] "Fdem_CC: CAA, vbK, vbLinf, vbt0, wla, wlb, steep, MaxAge"                   </span>
<span class="co">#&gt; [18] "Fdem_ML: vbK, vbLinf, vbt0, wla, wlb, steep, MaxAge, CAL"                   </span>
<span class="co">#&gt; [19] "FMSYref: OM"                                                                </span>
<span class="co">#&gt; [20] "FMSYref50: OM"                                                              </span>
<span class="co">#&gt; [21] "FMSYref75: OM"                                                              </span>
<span class="co">#&gt; [22] "Fratio: Abun"                                                               </span>
<span class="co">#&gt; [23] "Fratio_CC: CAA"                                                             </span>
<span class="co">#&gt; [24] "Fratio_ML: vbK, vbLinf, CAL"                                                </span>
<span class="co">#&gt; [25] "Fratio4010: Dep, Abun"                                                      </span>
<span class="co">#&gt; [26] "GB_CC: Cref"                                                                </span>
<span class="co">#&gt; [27] "GB_slope: Ind"                                                              </span>
<span class="co">#&gt; [28] "GB_target: Ind, Cref, Iref"                                                 </span>
<span class="co">#&gt; [29] "Gcontrol: Ind, Abun"                                                        </span>
<span class="co">#&gt; [30] "Islope1: Ind, MPrec"                                                        </span>
<span class="co">#&gt; [31] "Islope4: Ind, MPrec"                                                        </span>
<span class="co">#&gt; [32] "IT10: Ind, Iref, MPrec"                                                     </span>
<span class="co">#&gt; [33] "IT5: Ind, Iref, MPrec"                                                      </span>
<span class="co">#&gt; [34] "Itarget1: Ind"                                                              </span>
<span class="co">#&gt; [35] "Itarget4: Ind"                                                              </span>
<span class="co">#&gt; [36] "ITM: Ind, Iref, MPrec"                                                      </span>
<span class="co">#&gt; [37] "L95target: L50, L95, ML"                                                    </span>
<span class="co">#&gt; [38] "LBSPR_ItTAC: L50, L95, vbK, vbLinf, wlb, steep, CAL, MPrec"                 </span>
<span class="co">#&gt; [39] "LstepCC1: MPrec, ML"                                                        </span>
<span class="co">#&gt; [40] "LstepCC4: MPrec, ML"                                                        </span>
<span class="co">#&gt; [41] "Ltarget1: ML"                                                               </span>
<span class="co">#&gt; [42] "Ltarget4: ML"                                                               </span>
<span class="co">#&gt; [43] "MCD: Dep"                                                                   </span>
<span class="co">#&gt; [44] "MCD4010: Dep"                                                               </span>
<span class="co">#&gt; [45] "Rcontrol: Ind, Dep, Abun, vbK, vbLinf, vbt0, steep, MaxAge"                 </span>
<span class="co">#&gt; [46] "Rcontrol2: Ind, Dep, Abun, vbK, vbLinf, vbt0, steep, MaxAge"                </span>
<span class="co">#&gt; [47] "SBT1: Ind"                                                                  </span>
<span class="co">#&gt; [48] "SBT2: Rec, Cref"                                                            </span>
<span class="co">#&gt; [49] "SPmod: Ind, Abun"                                                           </span>
<span class="co">#&gt; [50] "SPMSY: L50, vbK, vbLinf, vbt0, MaxAge"                                      </span>
<span class="co">#&gt; [51] "SPslope: Ind, Abun"                                                         </span>
<span class="co">#&gt; [52] "SPSRA: Dep, vbK, vbLinf, vbt0, steep, MaxAge"                               </span>
<span class="co">#&gt; [53] "SPSRA_ML: vbK, vbLinf, vbt0, steep, MaxAge, CAL"                            </span>
<span class="co">#&gt; [54] "VPA: Ind, L50, LFC, LFS, CAA, vbK, vbLinf, vbt0, wla, wlb, steep, MaxAge"   </span>
<span class="co">#&gt; [55] "YPR: LFS, Abun, vbK, vbLinf, vbt0, wla, wlb, MaxAge"                        </span>
<span class="co">#&gt; [56] "YPR_CC: LFS, CAA, vbK, vbLinf, vbt0, wla, wlb, MaxAge"                      </span>
<span class="co">#&gt; [57] "YPR_ML: LFS, vbK, vbLinf, vbt0, wla, wlb, MaxAge, CAL"                      </span>
<span class="co">#&gt; [58] "DDe: Ind, L50, vbK, vbLinf, vbt0, wla, wlb, MaxAge"                         </span>
<span class="co">#&gt; [59] "DDe75: Ind, L50, vbK, vbLinf, vbt0, wla, wlb, MaxAge"                       </span>
<span class="co">#&gt; [60] "DDes: Ind, L50, vbK, vbLinf, vbt0, wla, wlb, MaxAge, MPeff"                 </span>
<span class="co">#&gt; [61] "DTe40: Dep, MPeff"                                                          </span>
<span class="co">#&gt; [62] "DTe50: Dep, MPeff"                                                          </span>
<span class="co">#&gt; [63] "ItargetE1: Ind, MPeff"                                                      </span>
<span class="co">#&gt; [64] "ItargetE4: Ind, MPeff"                                                      </span>
<span class="co">#&gt; [65] "ITe10: Ind, Iref, MPeff"                                                    </span>
<span class="co">#&gt; [66] "ITe5: Ind, Iref, MPeff"                                                     </span>
<span class="co">#&gt; [67] "LBSPR_ItEff: L50, L95, vbK, vbLinf, wlb, steep, CAL, MPeff"                 </span>
<span class="co">#&gt; [68] "LBSPR_ItSel: L50, L95, vbK, vbLinf, wlb, steep, CAL"                        </span>
<span class="co">#&gt; [69] "LstepCE1: MPeff, ML"                                                        </span>
<span class="co">#&gt; [70] "LstepCE2: MPeff, ML"                                                        </span>
<span class="co">#&gt; [71] "LtargetE1: MPeff, ML"                                                       </span>
<span class="co">#&gt; [72] "LtargetE4: MPeff, ML"                                                       </span>
<span class="co">#&gt; [73] "slotlim: L50, LFC, LFS, vbLinf"</span></code></pre></div>
<p>The function <code><a href="../reference/TAC.html">TAC()</a></code> automatically detects which MPs can be applied and calculates a TAC distribution for each MP, which can then be plotted.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">RockReal&lt;-<span class="kw"><a href="../reference/TAC.html">TAC</a></span>(China_rockfish)
<span class="kw">plot</span>(RockReal)</code></pre></div>
<p><img src="DLMtool_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
</div>
<div id="conduct-a-sensitivity-analysis" class="section level2">
<h2>Conduct a sensitivity analysis</h2>
<p>The sensitivity plot reveals which inputs to an MP most strongly affect the TAC recommendation. In principle this may help to focus data discussion on the most critical inputs and their credibility.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">RockReal &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Sense.html">Sense</a></span>(RockReal,<span class="st">"DCAC"</span>)</code></pre></div>
<p><img src="DLMtool_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
</div>
</div>
<div id="from-mse-to-management-recommendations" class="section level1">
<h1>From MSE to management recommendations</h1>
<p>In this section we take a more thorough, systematic approach to MSE and data implementation. This is an example of how DLMtool may be used to select MPs and then apply them to real data. This is intended to be a straw-man demonstration and in no way should this be interpreted as a recommendation about appropriate management objectives!</p>
<p>In this example our real-life stock is a moderately long-lived reef fish species of moderately high recruitment compensation that has been subject to fairly consistent fishing pressure over recent years. We suspect that fishing activities do not effectively operate on older age classes since the fish exhibit ontogenetic movements offshore where there is less fishing. In general the stock is thought to be a relatively low stock levels going by catch rate observations but frankly, we don&rsquo;t have a precise handle on stock depletion. Since fishing activities have changed spatial distribution and the stock is targeted there is the potential for hyper-stability in our observations of catch rates over time.</p>
<p>This section assumes that you have completed the prerequisites.</p>
<div id="building-an-appropriate-operating-model" class="section level2">
<h2>Building an appropriate operating model</h2>
<p>We start by specifying an operating model. Looking at the pre-built stock objects:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/avail.html">avail</a></span>(<span class="st">'Stock'</span>)
<span class="co">#&gt; character(0)</span></code></pre></div>
<p>We decide that the <code>Snapper</code> stock object is the closest fit.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ourstock &lt;-<span class="st"> </span>Snapper</code></pre></div>
<p>We make some modifications to better suit our particular case study such as higher natural mortality rate, stock depletion (D) between 5 and 30 per cent of unfished levels and a candidate MPA (between 5 - 15 percent of unfished biomass) with retention (probability of staying in the MPA) of 80 - 99 percent. Remember to get help on the OM objects and their slots type <code>class?OM</code> (or the components of the OM: <code>class?Stock</code>, <code>class?Fleet</code>, <code>class?Observation</code>) at the command line.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ourstock@M &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.2</span>,<span class="fl">0.25</span>)
ourstock@maxage &lt;-<span class="st"> </span><span class="dv">18</span>
ourstock@D &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.05</span>,<span class="fl">0.3</span>)
ourstock@Frac_area_1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.05</span>,<span class="fl">0.15</span>)
ourstock@Prob_staying &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.4</span>,<span class="fl">0.99</span>)</code></pre></div>
<p>We now choose a fleet type for our operating model and choose to modify a generic fleet of flat recent effort, adding dome-shaped vulnerability as a possibility for older age classes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ourfleet &lt;-<span class="st"> </span>Generic_FlatE
ourfleet@Vmaxlen &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.5</span>, <span class="dv">1</span>)</code></pre></div>
<p>Finally, using our fleet and stock objects we construct an operating model object assuming that the data we have are likely to be imprecise and potentially biased. Type <code><a href="../reference/avail.html">avail("Observation")</a></code> at the command line to see the various pre-defined observation model objects.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ourOM &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">'OM'</span>,ourstock, ourfleet, Imprecise_Biased)</code></pre></div>
</div>
<div id="mse-evaluation-of-methods" class="section level2">
<h2>MSE evaluation of methods</h2>
<p>Now that we have our operating model we run a trial MSE. In this case we use a very small number of simulations (16, which is low to meet CRAN-R package building requirements) but change the length of the projection and the length of the interval between updates to reflect our stock and management system.</p>
<p>We can see all of the available output control methods using the <code>avail</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/avail.html">avail</a></span>(<span class="st">"DLM_output"</span>)
<span class="co">#&gt;  [1] "AvC"         "BK"          "BK_CC"       "BK_ML"       "CC1"        </span>
<span class="co">#&gt;  [6] "CC4"         "CompSRA"     "CompSRA4010" "DAAC"        "DBSRA"      </span>
<span class="co">#&gt; [11] "DBSRA_40"    "DBSRA_ML"    "DBSRA4010"   "DCAC"        "DCAC_40"    </span>
<span class="co">#&gt; [16] "DCAC_ML"     "DCAC4010"    "DD"          "DD4010"      "DepF"       </span>
<span class="co">#&gt; [21] "DynF"        "Fadapt"      "Fdem"        "Fdem_CC"     "Fdem_ML"    </span>
<span class="co">#&gt; [26] "FMSYref"     "FMSYref50"   "FMSYref75"   "Fratio"      "Fratio_CC"  </span>
<span class="co">#&gt; [31] "Fratio_ML"   "Fratio4010"  "GB_CC"       "GB_slope"    "GB_target"  </span>
<span class="co">#&gt; [36] "Gcontrol"    "HDAAC"       "Islope1"     "Islope4"     "IT10"       </span>
<span class="co">#&gt; [41] "IT5"         "Itarget1"    "Itarget4"    "ITM"         "L95target"  </span>
<span class="co">#&gt; [46] "LBSPR_ItTAC" "LstepCC1"    "LstepCC4"    "Ltarget1"    "Ltarget4"   </span>
<span class="co">#&gt; [51] "MCD"         "MCD4010"     "NFref"       "Rcontrol"    "Rcontrol2"  </span>
<span class="co">#&gt; [56] "SBT1"        "SBT2"        "SPmod"       "SPMSY"       "SPslope"    </span>
<span class="co">#&gt; [61] "SPSRA"       "SPSRA_ML"    "VPA"         "YPR"         "YPR_CC"     </span>
<span class="co">#&gt; [66] "YPR_ML"</span></code></pre></div>
<p>and input control methods:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/avail.html">avail</a></span>(<span class="st">"DLM_output"</span>)
<span class="co">#&gt;  [1] "AvC"         "BK"          "BK_CC"       "BK_ML"       "CC1"        </span>
<span class="co">#&gt;  [6] "CC4"         "CompSRA"     "CompSRA4010" "DAAC"        "DBSRA"      </span>
<span class="co">#&gt; [11] "DBSRA_40"    "DBSRA_ML"    "DBSRA4010"   "DCAC"        "DCAC_40"    </span>
<span class="co">#&gt; [16] "DCAC_ML"     "DCAC4010"    "DD"          "DD4010"      "DepF"       </span>
<span class="co">#&gt; [21] "DynF"        "Fadapt"      "Fdem"        "Fdem_CC"     "Fdem_ML"    </span>
<span class="co">#&gt; [26] "FMSYref"     "FMSYref50"   "FMSYref75"   "Fratio"      "Fratio_CC"  </span>
<span class="co">#&gt; [31] "Fratio_ML"   "Fratio4010"  "GB_CC"       "GB_slope"    "GB_target"  </span>
<span class="co">#&gt; [36] "Gcontrol"    "HDAAC"       "Islope1"     "Islope4"     "IT10"       </span>
<span class="co">#&gt; [41] "IT5"         "Itarget1"    "Itarget4"    "ITM"         "L95target"  </span>
<span class="co">#&gt; [46] "LBSPR_ItTAC" "LstepCC1"    "LstepCC4"    "Ltarget1"    "Ltarget4"   </span>
<span class="co">#&gt; [51] "MCD"         "MCD4010"     "NFref"       "Rcontrol"    "Rcontrol2"  </span>
<span class="co">#&gt; [56] "SBT1"        "SBT2"        "SPmod"       "SPMSY"       "SPslope"    </span>
<span class="co">#&gt; [61] "SPSRA"       "SPSRA_ML"    "VPA"         "YPR"         "YPR_CC"     </span>
<span class="co">#&gt; [66] "YPR_ML"</span></code></pre></div>
<p>If you do not specify a vector of particular methods, the MSE will run for all possible MPs. Note that this could take a few minutes depending on how monstrous your computer is. In this example, we will choose a subset of the available methods:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MPs &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"BK"</span>, <span class="st">"CC1"</span>, <span class="st">"CompSRA"</span>, <span class="st">"DBSRA"</span>, <span class="st">"DBSRA4010"</span>, <span class="st">"DCAC"</span>, <span class="st">"DCAC4010"</span>, <span class="st">"DepF"</span>, <span class="st">"DynF"</span>,
         <span class="st">"Fratio"</span>, <span class="st">"Itarget1"</span>, <span class="st">"Itarget4"</span>, <span class="st">"MCD"</span>, <span class="st">"MCD4010"</span>, <span class="st">"SBT1"</span>)</code></pre></div>
<p>Note that in a real setting it might be advisable to increase the number of simulations (<code>nsim</code>) to at least 200 and, if stochastic MPs are to be used, increase the samples per method (<code>reps</code>) to at least 100 for this first stage to obtain stable aggregate results.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ourMSE &lt;-<span class="st"> </span><span class="kw"><a href="../reference/runMSE.html">runMSE</a></span>(ourOM, <span class="dt">MPs=</span>MPs, <span class="dt">proyears=</span><span class="dv">20</span>, <span class="dt">interval=</span><span class="dv">5</span>, <span class="dt">nsim=</span><span class="dv">16</span>,<span class="dt">reps=</span><span class="dv">1</span>)</code></pre></div>
<p>A summary trade-off plot reveals a wide range of performance:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/Tplot.html">Tplot</a></span>(ourMSE)</code></pre></div>
<p><img src="DLMtool_files/figure-html/unnamed-chunk-22-1.png" width="672"></p>
<p>In this example process, we decide that we would like to select a targeted subset of these MPs that have greater than 30 percent of long-term best yield (given ideal fixed fishing mortality rate), less than a 50 percent probability of overfishing and less than a 20 percent probability of dropping below a low stock level, in this case 50 percent of BMSY. To do this we calculate the summary table and subset it:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Results &lt;-<span class="st"> </span><span class="kw">summary</span>(ourMSE) 
<span class="kw">head</span>(Results)
<span class="co">#&gt;          MP Yield stdev   POF stdev    P10 stdev   P50 stdev  P100 stdev</span>
<span class="co">#&gt; 1        BK 68.17 46.57 45.62  44.79 21.88 33.46 45.00 45.17 59.38 43.74</span>
<span class="co">#&gt; 2       CC1 31.54 23.13 77.19  39.24 37.19 28.46 70.62 38.51 81.56 31.61</span>
<span class="co">#&gt; 3   CompSRA 33.80 45.70 84.38  27.20 55.94 28.24 77.81 32.76 85.00 29.44</span>
<span class="co">#&gt; 4     DBSRA 71.79 36.32 25.62  40.49  4.69 13.10 30.00 38.12 54.06 39.46</span>
<span class="co">#&gt; 5 DBSRA4010 86.92 69.24 18.44  23.71  0.31  1.25 18.44 25.01 42.50 34.40</span>
<span class="co">#&gt; 6      DCAC 58.73 32.72 57.19  41.75 17.50 25.88 48.12 43.85 68.44 37.09</span>
<span class="co">#&gt;    LTY  STY   VY</span>
<span class="co">#&gt; 1 56.2 36.9 50.0</span>
<span class="co">#&gt; 2 23.8 75.0 31.2</span>
<span class="co">#&gt; 3 18.1 48.8  6.2</span>
<span class="co">#&gt; 4 64.4 48.8 75.0</span>
<span class="co">#&gt; 5 58.8 30.0 25.0</span>
<span class="co">#&gt; 6 63.7 79.4 81.2</span>
Targetted &lt;-<span class="st"> </span><span class="kw">subset</span>(Results, Results$Yield&gt;<span class="dv">30</span> &amp;<span class="st"> </span>Results$POF&lt;<span class="dv">50</span> &amp;<span class="st"> </span>Results$P50&lt;<span class="dv">20</span>)
Targetted
<span class="co">#&gt;           MP Yield stdev   POF stdev   P10 stdev.1   P50 stdev.2  P100</span>
<span class="co">#&gt; 5  DBSRA4010 86.92 69.24 18.44  23.71 0.31    1.25 18.44   25.01 42.50</span>
<span class="co">#&gt; 7   DCAC4010 67.69 31.96 13.12  30.87 0.00    0.00  9.06   11.58 33.12</span>
<span class="co">#&gt; 12  Itarget4 76.36 36.83  5.62  13.52 0.00    0.00 13.12   17.50 32.81</span>
<span class="co">#&gt; 13       MCD 73.55 29.45 17.81  34.20 0.00    0.00 18.44   31.08 40.31</span>
<span class="co">#&gt; 14   MCD4010 63.22 43.29 13.75  26.11 0.00    0.00 14.06   24.51 33.12</span>
<span class="co">#&gt;    stdev.3  LTY  STY   VY</span>
<span class="co">#&gt; 5    34.40 58.8 30.0 25.0</span>
<span class="co">#&gt; 7    30.38 65.6 34.4 62.5</span>
<span class="co">#&gt; 12   27.69 75.0 21.9 93.8</span>
<span class="co">#&gt; 13   30.96 68.8 22.5 87.5</span>
<span class="co">#&gt; 14   30.49 56.2 18.8 50.0</span></code></pre></div>
<p>Our new subsetted methods can be used to run a more focused MSE that includes a greater number of simulations for a detailed assessment of performance. Again note that in a real setting it would be advisable to increase the number of simulations further to at least 400. You might also want to increase the number of stochastic samples per method (reps) to 200 or more.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">TargMP &lt;-<span class="st"> </span>Targetted$MP[<span class="kw">grep</span>(<span class="st">"FMSYref"</span>,Targetted$MP,<span class="dt">invert=</span>T)]
ourMSE2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/runMSE.html">runMSE</a></span>(ourOM, TargMP, <span class="dt">proyears=</span><span class="dv">20</span>, <span class="dt">interval=</span><span class="dv">5</span>, <span class="dt">nsim=</span><span class="dv">16</span>, <span class="dt">reps=</span><span class="dv">1</span>)</code></pre></div>
<p>Let&rsquo;s check convergence in some performance metrics as simulations are added (the first plot is for all MPs, the second shows only those that did not converge):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/CheckConverg.html">CheckConverg</a></span>(ourMSE2)</code></pre></div>
<p><img src="DLMtool_files/figure-html/unnamed-chunk-24-1.png" width="672"></p>
<pre><code>#&gt; Some MPs may not have converged in 16 iterations (threshold = 2%)
#&gt; MPs are: DBSRA4010  DCAC4010  Itarget4  MCD  MCD4010
#&gt; MPs #: 1  2  3  4  5
#&gt;   Num        MP
#&gt; 1   1 DBSRA4010
#&gt; 2   2  DCAC4010
#&gt; 3   3  Itarget4
#&gt; 4   4       MCD
#&gt; 5   5   MCD4010</code></pre>
<p><img src="DLMtool_files/figure-html/unnamed-chunk-24-2.png" width="672"></p>
<p>Several detailed plots can provide greater information about exactly how each MP performed over the projected time period including Projection plots:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/Pplot.html">Pplot</a></span>(ourMSE2)</code></pre></div>
<p><img src="DLMtool_files/figure-html/unnamed-chunk-25-1.png" width="672"></p>
<p>Kobe plots:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/Kplot.html">Kplot</a></span>(ourMSE2)</code></pre></div>
<p><img src="DLMtool_files/figure-html/unnamed-chunk-26-1.png" width="672"></p>
<p>and alternative trade-off plots:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/Tplot2.html">Tplot2</a></span>(ourMSE2)</code></pre></div>
<p><img src="DLMtool_files/figure-html/unnamed-chunk-27-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/TradePlot.html">TradePlot</a></span>(ourMSE2, <span class="dt">XThresh=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="dt">YThresh=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="dt">ShowLabs =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="DLMtool_files/figure-html/TradePlot-1.png" width="672"></p>
<pre><code>#&gt; [[1]]
#&gt;          MP    X    Y
#&gt; 1 DBSRA4010 81.6 86.9
#&gt; 2  Itarget4 94.4 76.4
#&gt; 3       MCD 82.2 73.5
#&gt; 4  DCAC4010 86.9 67.7
#&gt; 5   MCD4010 86.2 63.2
#&gt; 
#&gt; [[2]]
#&gt;          MP    X     Y
#&gt; 1  DCAC4010 90.9 100.0
#&gt; 2  Itarget4 86.9  93.8
#&gt; 3       MCD 81.6 100.0
#&gt; 4   MCD4010 85.9  68.8
#&gt; 5 DBSRA4010 81.6  25.0</code></pre>
<!--
These plots indicate that the depletion based *F* MPs based on a fixed ratio of FMSY to M (`DepF`) and the simple delay-difference model (`DD`) linked ot the 40-10 harvest control rule (`DD4010`) are at the upper limit of the trade-off space (i.e., all other MPs provide worse performance in one or more dimensions). In this case the MPs offer a contrasting trade-off between probability of overfishing and long-term yield. It remains to be seen whether these approaches can be applied to the real data for our reef fish. 
-->
</div>
<div id="value-of-information-analysis" class="section level2">
<h2>Value of information analysis</h2>
<p>A value of information function is available that allows users to establish which of the sampled parameters of the operating model or the observation model are most correlated with performance. This helps to guide future data collection effort to target those inputs that are most critical for performance. The VOI function also provides a metric of the robustness of MPs: while an MP&rsquo;s aggregate mean performance may be quite good it might be concerning if performance was strongly compromised given alternative plausible scenarios.</p>
<p>The inputs are organized in order of most correlated to least correlated from left to right. The label of the plots indicates a sampled parameter in either <code>ourMSE2@OM</code> (operating model parameters) or <code>ourMSE2@Obs</code> (observation model parameters). The help file for these slots provides details on how to interpret these labels. For example <code>Mbias</code> is bias in the observed value of natural mortality rate, <code>Dbias</code> is bias in the observed value of stock depletion. Note that in a real analysis many more simulations should be undertaken to provide a reliable performance pattern. I.e., <code>nsim</code> should be higher when using <code><a href="../reference/runMSE.html">runMSE()</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/VOI.html">VOI</a></span>(ourMSE2)</code></pre></div>
<p><img src="DLMtool_files/figure-html/unnamed-chunk-28-1.png" width="672"><img src="DLMtool_files/figure-html/unnamed-chunk-28-2.png" width="672"></p>
<pre><code>#&gt; [[1]]
#&gt;           MP            1       2        3        4      5      6
#&gt; 1  DBSRA4010 Prob_staying dFfinal      Ksd     ageM   lenM      K
#&gt; 2                   74.42   73.54    70.92     70.5  68.24  65.26
#&gt; 3   DCAC4010      BMSY_B0  Linfsd    Mgrad Linfgrad     AC    qcv
#&gt; 4                   32.34   32.23    30.85     30.5   30.2  29.85
#&gt; 5   Itarget4           hs     Esd  Vmaxlen    Mgrad  Kgrad    Msd
#&gt; 6                   42.56   40.31    39.72    35.82  33.72  33.67
#&gt; 7        MCD      BMSY_B0      AC Linfgrad    len95 procsd     L5
#&gt; 8                   30.94   29.56    28.84    28.82  28.25  26.78
#&gt; 9    MCD4010           AC     Msd Linfgrad  BMSY_B0    qcv procsd
#&gt; 10                   47.4   43.62    42.92     41.9  39.65  37.29
#&gt; 
#&gt; [[2]]
#&gt;           MP     1     2      3           4          5     6
#&gt; 1  DBSRA4010  Derr Cbias t0bias    Linfbias FMSY_Mbias Mbias
#&gt; 2            68.95 66.89  63.24       62.37      53.38 53.32
#&gt; 3   DCAC4010 Cbias Dbias  Mbias BMSY_B0bias       Derr   Csd
#&gt; 4            33.94  26.5  25.84       23.87      22.32 21.94
#&gt; 5   Itarget4   Csd Cbias    Isd                             
#&gt; 6             31.8 28.59  28.32                             
#&gt; 7        MCD Cbias  Derr  Dbias         Csd                 
#&gt; 8            28.79 26.81  23.85       16.33                 
#&gt; 9    MCD4010 Cbias  Derr    Csd       Dbias                 
#&gt; 10           42.02 33.08  30.99       29.39</code></pre>
</div>
<div id="applying-mps-to-our-real-data" class="section level2">
<h2>Applying MPs to our real data</h2>
<p>A real DLM_data object <code>ourReefFish</code>, was loaded into the current R session when we loaded up the data in the Prerequisites section above. We can summarise some of the data in this DLM_data object using the generic function <code>summary()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(ourReefFish)</code></pre></div>
<p><img src="DLMtool_files/figure-html/unnamed-chunk-29-1.png" width="672"> The <code><a href="../reference/Can.html">Can()</a></code> function reveals that a range of MPs are available, and we can calculate and plot the TACs for the available methods:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ourReefFish &lt;-<span class="st"> </span><span class="kw"><a href="../reference/TAC.html">TAC</a></span>(ourReefFish)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">boxplot</span>(ourReefFish)</code></pre></div>
<pre><code>#&gt; [1] "Method SPmod produced greater than 50% NA values"</code></pre>
<p><img src="DLMtool_files/figure-html/Load-1.png" width="672"></p>
<pre><code>#&gt;             MP Median     SD           Units
#&gt; 1  CompSRA4010   0.15   0.00 thousand tonnes
#&gt; 2      MCD4010   0.25   0.20 thousand tonnes
#&gt; 3    DBSRA4010   0.25   0.25 thousand tonnes
#&gt; 4    Fratio_ML   0.34   0.12 thousand tonnes
#&gt; 5       YPR_ML   0.43   0.16 thousand tonnes
#&gt; 6       DD4010   0.62   1.63 thousand tonnes
#&gt; 7        DBSRA   0.72   0.25 thousand tonnes
#&gt; 8          MCD   0.75   0.25 thousand tonnes
#&gt; 9        HDAAC   1.01   0.30 thousand tonnes
#&gt; 10     CompSRA   1.04   0.00 thousand tonnes
#&gt; 11    Itarget4   1.11   0.10 thousand tonnes
#&gt; 12   Fratio_CC   1.12   2.02 thousand tonnes
#&gt; 13      YPR_CC   1.17   1.28 thousand tonnes
#&gt; 14     DCAC_40   1.17   0.12 thousand tonnes
#&gt; 15    DCAC4010   1.24   0.19 thousand tonnes
#&gt; 16        DCAC   1.25   0.18 thousand tonnes
#&gt; 17       SPSRA   1.37 140.60 thousand tonnes
#&gt; 18       BK_ML   1.38   0.30 thousand tonnes
#&gt; 19          DD   1.39   0.73 thousand tonnes
#&gt; 20     Islope4   1.57   0.17 thousand tonnes
#&gt; 21         CC4   1.83   0.18 thousand tonnes
#&gt; 22    DBSRA_40   1.86   0.99 thousand tonnes
#&gt; 23         AvC   1.91   0.38 thousand tonnes
#&gt; 24    Itarget1   2.04   0.18 thousand tonnes
#&gt; 25     Islope1   2.11   0.18 thousand tonnes
#&gt; 26       SPmod   2.11   0.53 thousand tonnes
#&gt; 27    GB_slope   2.17   0.31 thousand tonnes
#&gt; 28     Fdem_ML   2.21   1.43 thousand tonnes
#&gt; 29        SBT1   2.21   0.45 thousand tonnes
#&gt; 30        DAAC   2.29   0.83 thousand tonnes
#&gt; 31       SPMSY   2.44   0.72 thousand tonnes
#&gt; 32         CC1   2.64   0.25 thousand tonnes
#&gt; 33       BK_CC   4.61   6.46 thousand tonnes
#&gt; 34     DCAC_ML   6.00   7.92 thousand tonnes
#&gt; 35     Fdem_CC   8.60  10.90 thousand tonnes
#&gt; 36    DBSRA_ML 106.11  28.37 thousand tonnes
#&gt; 37    SPSRA_ML 454.48 455.57 thousand tonnes</code></pre>
<!--
The `Needed()` function shows that there is only one data requirement to make many of the remaining MPs work, a current estimate of abundance (`Abun`, a slot in the DLM\_data object. See `class?DLM`). While this may seem like rather a demanding data requirement it is worth remembering that `DynF`, `Fratio` and `YPR` outperformed the remaining methods on average despite fairly poor current abundance information that could have observation error with a CV of up to 100 per cent and a bias sampled from a uniform-on-log distribution distribution between 1/5 and 5:

```r
ourOM@Btcv
#> [1] 0.2 0.5
ourOM@Btbias
#> [1] 0.2 5.0
```

In other words our MSE generated observations of current biomass that could easily be 1/5 or five times the true level  across the whole time series and were very noisy. The question now is whether gathering such data would be worthwhile (e.g. a systematic fishery independent survey). To refresh our memory we can re-plot the tradeoffs of the targetted MSE:


```r
Tplot2(ourMSE2)
```

<img src="DLMtool_files/figure-html/unnamed-chunk-31-1.png" width="672" />
-->
<p>If we focus on output controls there are a cluster of MPs that offer comparable performance that are available for our real data such as the Mean Catch Depletion method (<code>MCD</code>). We can use sensitivity testing to better understand how fragile TAC recommendations are to changes in our data inputs:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ourReefFish &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Sense.html">Sense</a></span>(ourReefFish,<span class="st">'MCD'</span>)</code></pre></div>
<p><img src="DLMtool_files/figure-html/sense-1.png" width="672"></p>
<p>Not surprisingly, the Mean Catch Depletion method is sensitive to the error in historical catch and current depletion. <!--
In this case it is a toss-up between them. Both show primary sensitivity to bias in reported catches (fairly obviously) and little sensitivity to the remaining inputs. In this case it might be necessary to try an alternative run of the operating model given other credible parameters to see if we can distinguish between these MPs.
--></p>
</div>
<div id="what-have-we-learned" class="section level2">
<h2>What have we learned?</h2>
<p>In this simple walk-through we have established what MPs work best for our stock, fishery and observation type. It was possible to establish the frailties of these MPs by examining what simulated parameters drive yield and probability of overfishing (using the <code><a href="../reference/VOI.html">VOI()</a></code> function). Our application to real data produced actual TAC recommendations for MPs that were available. Several MPs could not be applied, and the MSE results can be used to evaluate whether these MPs are likely to provide benefits in terms of both yield and limiting overfishing (remember that with such a small number of simulations in this example, these results are not reliable!). We know what data are necessary to make these work but have yet to decide whether collecting these data is worthwhile. Above all, the approach is transparent and reproducible.</p>
<p>Depending on how utility is characterised, it may be possible to establish the cost-efficacy of future data-collection based on the long-term yield differential of the methods that are available and those that need additional data.</p>
</div>
</div>
<div id="designing-new-methods" class="section level1">
<h1>Designing new methods</h1>
<p>DLMtool was designed to be extensible in order to promote the development of new MPs. In this section we design a series of new MPs that include spatial controls and input controls in the form of age-restrictions. The central requirement of any MP is that it can be applied to a DLM_data object using the function sapply (<code>sfSapply()</code> in parallel processing).</p>
<p>DLM_data objects have a single position x for each data entry, e.g.&nbsp;one value for natural mortality rate, a single vector of historical catches etc. In the MSE analysis this is extended to nsim positions. It follows that any MP arranged to function <code>sapply(x,MP,DLM\_data)</code> will work. For example we can get 5 stochastic samples of the TAC for the demographic FMSY MP paired to catch-curve analysis <code>FdemCC</code> applied to a real data-limited data object for red snapper using:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sapply</span>(<span class="dv">1</span>,Fdem_CC,Red_snapper,<span class="dt">reps=</span><span class="dv">5</span>)
<span class="co">#&gt;           [,1]</span>
<span class="co">#&gt; [1,]  4.886200</span>
<span class="co">#&gt; [2,] 15.418623</span>
<span class="co">#&gt; [3,]  3.581622</span>
<span class="co">#&gt; [4,]  8.404568</span>
<span class="co">#&gt; [5,]  3.664844</span></code></pre></div>
<p>The MSE just populates a DLM_data object with many simulations and uses <code>sfSapply()</code> (snowfall cluster computing equivalent) to calculate an management recommendation for each simulation. By making methods compatible with this standard the very same equations are used in both the MSE and the real management advice.</p>
<p>The following new MPs illustrate this.</p>
<div id="average-historical-catch-mp" class="section level2">
<h2>Average historical catch MP</h2>
<p>The average historical catch has been suggested as a starting point for setting TACs in the most data-limited situations (following Restrepo et al. 1998). Here we design such an MP:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">AvC &lt;-function(x, DLM_data, reps)<span class="kw">rlnorm</span>(reps, <span class="kw">log</span>(<span class="kw">mean</span>(DLM_data@Cat[x,], <span class="dt">na.rm=</span>T)), <span class="fl">0.1</span>) </code></pre></div>
<p>Note that all MPs have to be stochastic in this framework which is why we sample from a log-normal distribution with a CV of roughly 10 per cent.</p>
<p>Before the MP can be &lsquo;seen&rsquo; by the rest of the DLM package we have to do three more things. The MP must be assigned a class based on what outputs it provides. Since this is an output control (TAC) based MP we assign it class <code>DLM_output</code>. The MP must also be assigned to the DLMtool namespace:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(AvC) &lt;-<span class="st">"DLM_output"</span>
<span class="kw">environment</span>(AvC) &lt;-<span class="kw">asNamespace</span>(<span class="st">'DLMtool'</span>)</code></pre></div>
<p>and - if we are using parallel computing - exported to the cluster:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sfExport</span>(<span class="st">"AvC"</span>)</code></pre></div>
</div>
<div id="third-highest-catch" class="section level2">
<h2>Third-highest catch</h2>
<p>In some data-limited settings third highest historical catch has been suggested as a possible catch-limit. Here we use a similar approach to the average catch MP above (<code>AvC</code>) and take draws from a log-normal distribution with CV of 10 per cent:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">THC&lt;-function(x,DLM_data, reps){
  <span class="kw">rlnorm</span>(reps,<span class="kw">log</span>(DLM_data@Cat[x,<span class="kw">order</span>(DLM_data@Cat[x,],<span class="dt">decreasing=</span>T)[<span class="dv">3</span>]]),<span class="fl">0.1</span>)
}
<span class="kw">class</span>(THC)&lt;-<span class="st">"DLM_output"</span>
<span class="kw">environment</span>(THC) &lt;-<span class="st"> </span><span class="kw">asNamespace</span>(<span class="st">'DLMtool'</span>)</code></pre></div>
<p>and again export to cluster (if we are using parallel computing):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sfExport</span>(<span class="st">"THC"</span>)</code></pre></div>
</div>
<div id="length-at-selection-set-equal-to-length-at-maturity" class="section level2">
<h2>Length-at-selection set equal to length-at-maturity</h2>
<p>To simulate input controls that aim to alter the length-vulnerability to fishing it is possible to design an MP of class <code>DLM\_input</code>. These simply describe sets the length at 5% selection and smallest length at full selection. In this example we set selectivity equal to the maturity curve:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">matlenlim &lt;-<span class="st"> </span>function (x, DLM_data, ...) {
    dependencies =<span class="st"> "DLM_data@LFC, DLM_data@LFS"</span>
    Allocate &lt;-<span class="st"> </span><span class="dv">1</span>
    Effort &lt;-<span class="st"> </span><span class="dv">1</span>
    Spatial &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>)
    newLFC &lt;-<span class="st"> </span>DLM_data@L50[x] *<span class="st"> </span><span class="fl">0.95</span>
    newLFS &lt;-<span class="st"> </span>DLM_data@L50[x]
    Vuln &lt;-<span class="st"> </span><span class="kw">c</span>(newLFC, newLFS)
    <span class="kw">c</span>(Allocate, Effort, Spatial, Vuln)
}
<span class="kw">class</span>(matlenlim) &lt;-<span class="st"> "DLM_input"</span>
<span class="kw">environment</span>(matlenlim) &lt;-<span class="st"> </span><span class="kw">asNamespace</span>(<span class="st">"DLMtool"</span>)</code></pre></div>
<p>and export to cluster:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sfExport</span>(<span class="st">"matlenlim"</span>)</code></pre></div>
<p>Note that for compatibility, these approaches still require an &lsquo;x&rsquo; argument even if they don&rsquo;t make use of it (i.e., they are the same regardless of the data or simulated data).<br>
Also note that the arguments for the input methods must include either <code>reps</code> or <code>...</code>, even if these are not used.</p>
</div>
<div id="reducing-fishing-rate-in-area-1-by-50-per-cent" class="section level2">
<h2>Reducing fishing rate in area 1 by 50 per cent</h2>
<p>Spatial controls operate similarly to the age/size based controls: a vector of length 2 (the spatial simulator is a 2-box model) that indicates the fraction of current spatial catches. In this example we reduce catches in area 1 by 50 percent and assign the MP class &lsquo;DLM space&rsquo;.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">area1_50&lt;-function(x,DLM_data, ...){ 
  Allocate&lt;-<span class="dv">0</span> <span class="co"># Fraction of effort reallocated to open area</span>
  Effort&lt;-<span class="dv">1</span>  <span class="co"># Fraction of effort in last historical year</span>
  Spatial&lt;-<span class="kw">c</span>(<span class="fl">0.5</span>,<span class="dv">1</span>) <span class="co"># Fraction of effort found in each area</span>
  Vuln&lt;-<span class="kw">rep</span>(<span class="ot">NA</span>,<span class="dv">2</span>) <span class="co"># Length vulnerability is not specified   </span>
  <span class="kw">c</span>(Allocate, Effort, Spatial, Vuln) <span class="co"># Input controls stitched togther</span>
}
<span class="kw">class</span>(area1_50)&lt;-<span class="st">"DLM_input"</span>
<span class="kw">environment</span>(area1_50) &lt;-<span class="st"> </span><span class="kw">asNamespace</span>(<span class="st">'DLMtool'</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sfExport</span>(<span class="st">"area1_50"</span>)</code></pre></div>
</div>
<div id="applying-the-new-mps" class="section level2">
<h2>Applying the new MPs</h2>
<p>Our MPs are now compatible with all of the DLMtool functionality. Let&rsquo;s run a quick MSE and see how they fare:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new_MPs &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"AvC"</span>,<span class="st">"THC"</span>,<span class="st">"matlenlim"</span>,<span class="st">"area1_50"</span>)
OM &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">'OM'</span>,Porgy, Generic_IncE, Imprecise_Unbiased)
PorgMSE &lt;-<span class="st"> </span><span class="kw"><a href="../reference/runMSE.html">runMSE</a></span>(OM,new_MPs,<span class="dt">maxF=</span><span class="dv">1</span>,<span class="dt">nsim=</span><span class="dv">20</span>,<span class="dt">reps=</span><span class="dv">1</span>,<span class="dt">proyears=</span><span class="dv">20</span>,<span class="dt">interval=</span><span class="dv">5</span>) </code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/Tplot.html">Tplot</a></span>(PorgMSE)  </code></pre></div>
<p><img src="DLMtool_files/figure-html/unnamed-chunk-43-1.png" width="672"></p>
<p>What if starting depletion were different, e.g.&nbsp;likely to be under BMSY?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">OM@D
OM@D &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.05</span>,<span class="fl">0.3</span>)
PorgMSE2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/runMSE.html">runMSE</a></span>(OM, new_MPs, <span class="dt">maxF=</span><span class="dv">1</span>, <span class="dt">nsim=</span><span class="dv">20</span>, <span class="dt">reps=</span><span class="dv">1</span>, <span class="dt">proyears=</span><span class="dv">20</span>, <span class="dt">interval=</span><span class="dv">5</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/Tplot.html">Tplot</a></span>(PorgMSE2)  </code></pre></div>
<p><img src="DLMtool_files/figure-html/unnamed-chunk-45-1.png" width="672"></p>
<p>Conveniently putting aside the likelihood of implementing a perfect knife-edge vulnerability at length-at-maturity, it appears that we have a winner in <code>matlenlim</code> even under different starting depletion levels. Third highest catch on the other hand appears risky to say the least. You could try some other starting depletion levels to see under what circumstances the trade-off space changes dramatically.</p>
</div>
</div>
<div id="managing-real-data" class="section level1">
<h1>Managing real data</h1>
<p>DLMtool has a series of functions to make importing data and applying data-limited MPs relatively straightforward. There are two approaches: (1) fill out a .csv data file in excel or a text editor and use a DLMtool function to create a properly formatted DLM_data object (class DLM_data) or (2) create a blank DLM_data object in R and populate it in R.</p>
<div id="importing-data" class="section level2">
<h2>Importing data</h2>
<p>Probably the easiest way to get your data into the DLMtool is to populate a .csv datafile. These files have a line for each slot of the DLM_data object e.g:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">slotNames</span>(<span class="st">'DLM_data'</span>)
<span class="co">#&gt;  [1] "Name"       "Year"       "Cat"        "Ind"        "Rec"       </span>
<span class="co">#&gt;  [6] "t"          "AvC"        "Dt"         "Mort"       "FMSY_M"    </span>
<span class="co">#&gt; [11] "BMSY_B0"    "Cref"       "Bref"       "Iref"       "L50"       </span>
<span class="co">#&gt; [16] "L95"        "LFC"        "LFS"        "CAA"        "Dep"       </span>
<span class="co">#&gt; [21] "Abun"       "vbK"        "vbLinf"     "vbt0"       "wla"       </span>
<span class="co">#&gt; [26] "wlb"        "steep"      "CV_Cat"     "CV_Dt"      "CV_AvC"    </span>
<span class="co">#&gt; [31] "CV_Ind"     "CV_Mort"    "CV_FMSY_M"  "CV_BMSY_B0" "CV_Cref"   </span>
<span class="co">#&gt; [36] "CV_Bref"    "CV_Iref"    "CV_Rec"     "CV_Dep"     "CV_Abun"   </span>
<span class="co">#&gt; [41] "CV_vbK"     "CV_vbLinf"  "CV_vbt0"    "CV_L50"     "CV_LFC"    </span>
<span class="co">#&gt; [46] "CV_LFS"     "CV_wla"     "CV_wlb"     "CV_steep"   "sigmaL"    </span>
<span class="co">#&gt; [51] "MaxAge"     "Units"      "Ref"        "Ref_type"   "Log"       </span>
<span class="co">#&gt; [56] "params"     "PosMPs"     "MPs"        "OM"         "Obs"       </span>
<span class="co">#&gt; [61] "TAC"        "TACbias"    "Sense"      "CAL_bins"   "CAL"       </span>
<span class="co">#&gt; [66] "MPrec"      "MPeff"      "ML"         "Lbar"       "Lc"        </span>
<span class="co">#&gt; [71] "LHYear"     "Misc"</span></code></pre></div>
<p>You do not have to enter data for every line of the data file, if data are not available simply put an &lsquo;NA&rsquo; next to any given field. A number of example .csv files can be found in the directory where the DLMtool package was installed:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/DLMDataDir.html">DLMDataDir</a></span>()
<span class="co">#&gt; [1] "E:\\GitRepos\\DLMtool/"</span></code></pre></div>
<p>To get data from a .csv file you need only specify its location e.g <code>new('DLM_data',"I:/Mackerel.csv")</code>.</p>
</div>
<div id="populating-a-dlm_data-object-in-r" class="section level2">
<h2>Populating a <code>DLM_data</code> object in R</h2>
<p>Alternatively you can create a blank <code>DLM_data</code> object and fill the slots directly in R. E.g:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Madeup&lt;-<span class="kw">new</span>(<span class="st">'DLM_data'</span>)                             <span class="co">#  Create a blank DLM object</span>
<span class="co">#&gt; [1] "Couldn't find specified csv file, blank DLM object created"</span>
Madeup@Name&lt;-<span class="st">'Test'</span>                                 <span class="co">#  Name it</span>
Madeup@Cat&lt;-<span class="kw">matrix</span>(<span class="dv">20</span>:<span class="dv">11</span>*<span class="kw">rlnorm</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="fl">0.2</span>),<span class="dt">nrow=</span><span class="dv">1</span>)   <span class="co">#  Generate fake catch data</span>
Madeup@Units&lt;-<span class="st">"Million metric tonnes"</span>               <span class="co">#  State units of catch</span>
Madeup@AvC&lt;-<span class="kw">mean</span>(Madeup@Cat)                        <span class="co">#  Average catches for time t (DCAC)</span>
Madeup@t&lt;-<span class="kw">ncol</span>(Madeup@Cat)                          <span class="co">#  No. yrs for Av. catch (DCAC)</span>
Madeup@Dt&lt;-<span class="fl">0.5</span>                                      <span class="co">#  Depletion over time t (DCAC)</span>
Madeup@Dep&lt;-<span class="fl">0.5</span>                                     <span class="co">#  Depletion relative to unfished </span>
Madeup@vbK&lt;-<span class="fl">0.2</span>                                     <span class="co">#  VB maximum growth rate</span>
Madeup@vbt0&lt;-(-<span class="fl">0.5</span>)                                 <span class="co">#  VB theoretical age at zero length</span>
Madeup@vbLinf&lt;-<span class="dv">200</span>                                  <span class="co">#  VB maximum length</span>
Madeup@Mort&lt;-<span class="fl">0.1</span>                                    <span class="co">#  Natural mortality rate</span>
Madeup@Abun&lt;-<span class="dv">200</span>                                    <span class="co">#  Current abundance</span>
Madeup@FMSY_M&lt;-<span class="fl">0.75</span>                                 <span class="co">#  Ratio of FMSY/M</span>
Madeup@L50&lt;-<span class="dv">100</span>                                     <span class="co">#  Length at 50% maturity</span>
Madeup@L95&lt;-<span class="dv">120</span>                                     <span class="co">#  Length at 95% maturity</span>
Madeup@BMSY_B0&lt;-<span class="fl">0.35</span>                                <span class="co">#  BMSY relative to unfished</span></code></pre></div>
</div>
<div id="working-with-dlm_data-objects" class="section level2">
<h2>Working with <code>DLM_data</code> objects</h2>
<p>A generic summary function is available to visualize the data in a <code>DLM_data</code> object:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(Atlantic_mackerel)</code></pre></div>
<p><img src="DLMtool_files/figure-html/unnamed-chunk-48-1.png" width="672"></p>
<p>You can see what MPs can and can&rsquo;t be applied given your data and also what data are needed to get MPs working:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/Can.html">Can</a></span>(Atlantic_mackerel)
<span class="co">#&gt;  [1] "AvC"         "BK"          "CC1"         "CC4"         "DAAC"       </span>
<span class="co">#&gt;  [6] "DBSRA"       "DBSRA_40"    "DBSRA4010"   "DCAC"        "DCAC_40"    </span>
<span class="co">#&gt; [11] "DCAC4010"    "DD"          "DD4010"      "DepF"        "DynF"       </span>
<span class="co">#&gt; [16] "Fadapt"      "Fdem"        "Fratio"      "Fratio4010"  "GB_slope"   </span>
<span class="co">#&gt; [21] "Gcontrol"    "HDAAC"       "Islope1"     "Islope4"     "Itarget1"   </span>
<span class="co">#&gt; [26] "Itarget4"    "MCD"         "MCD4010"     "NFref"       "Rcontrol"   </span>
<span class="co">#&gt; [31] "Rcontrol2"   "SBT1"        "SPmod"       "SPMSY"       "SPslope"    </span>
<span class="co">#&gt; [36] "SPSRA"       "YPR"         "curE"        "curE75"      "DDe"        </span>
<span class="co">#&gt; [41] "DDe75"       "DTe40"       "DTe50"       "EtargetLopt" "ItargetE1"  </span>
<span class="co">#&gt; [46] "ItargetE4"   "matlenlim"   "matlenlim2"  "minlenLopt1" "MRnoreal"   </span>
<span class="co">#&gt; [51] "MRreal"      "slotlim"</span>
<span class="kw"><a href="../reference/Cant.html">Cant</a></span>(Atlantic_mackerel)
<span class="co">#&gt;       [,1]          [,2]                    </span>
<span class="co">#&gt;  [1,] "BK_CC"       "Insufficient data"     </span>
<span class="co">#&gt;  [2,] "BK_ML"       "Insufficient data"     </span>
<span class="co">#&gt;  [3,] "CompSRA"     "Insufficient data"     </span>
<span class="co">#&gt;  [4,] "CompSRA4010" "Insufficient data"     </span>
<span class="co">#&gt;  [5,] "DBSRA_ML"    "Insufficient data"     </span>
<span class="co">#&gt;  [6,] "DCAC_ML"     "Insufficient data"     </span>
<span class="co">#&gt;  [7,] "Fdem_CC"     "Insufficient data"     </span>
<span class="co">#&gt;  [8,] "Fdem_ML"     "Insufficient data"     </span>
<span class="co">#&gt;  [9,] "FMSYref"     "Insufficient data"     </span>
<span class="co">#&gt; [10,] "FMSYref50"   "Insufficient data"     </span>
<span class="co">#&gt; [11,] "FMSYref75"   "Insufficient data"     </span>
<span class="co">#&gt; [12,] "Fratio_CC"   "Insufficient data"     </span>
<span class="co">#&gt; [13,] "Fratio_ML"   "Insufficient data"     </span>
<span class="co">#&gt; [14,] "GB_CC"       "Produced all NA scores"</span>
<span class="co">#&gt; [15,] "GB_target"   "Produced all NA scores"</span>
<span class="co">#&gt; [16,] "IT10"        "Insufficient data"     </span>
<span class="co">#&gt; [17,] "IT5"         "Insufficient data"     </span>
<span class="co">#&gt; [18,] "ITM"         "Insufficient data"     </span>
<span class="co">#&gt; [19,] "L95target"   "Insufficient data"     </span>
<span class="co">#&gt; [20,] "LBSPR_ItTAC" "Produced all NA scores"</span>
<span class="co">#&gt; [21,] "LstepCC1"    "Insufficient data"     </span>
<span class="co">#&gt; [22,] "LstepCC4"    "Insufficient data"     </span>
<span class="co">#&gt; [23,] "Ltarget1"    "Insufficient data"     </span>
<span class="co">#&gt; [24,] "Ltarget4"    "Insufficient data"     </span>
<span class="co">#&gt; [25,] "SBT2"        "Produced all NA scores"</span>
<span class="co">#&gt; [26,] "SPSRA_ML"    "Insufficient data"     </span>
<span class="co">#&gt; [27,] "VPA"         "Insufficient data"     </span>
<span class="co">#&gt; [28,] "YPR_CC"      "Insufficient data"     </span>
<span class="co">#&gt; [29,] "YPR_ML"      "Insufficient data"     </span>
<span class="co">#&gt; [30,] "DDes"        "Insufficient data"     </span>
<span class="co">#&gt; [31,] "ITe10"       "Insufficient data"     </span>
<span class="co">#&gt; [32,] "ITe5"        "Insufficient data"     </span>
<span class="co">#&gt; [33,] "LBSPR_ItEff" "Insufficient data"     </span>
<span class="co">#&gt; [34,] "LBSPR_ItSel" "Insufficient data"     </span>
<span class="co">#&gt; [35,] "LstepCE1"    "Insufficient data"     </span>
<span class="co">#&gt; [36,] "LstepCE2"    "Insufficient data"     </span>
<span class="co">#&gt; [37,] "LtargetE1"   "Insufficient data"     </span>
<span class="co">#&gt; [38,] "LtargetE4"   "Insufficient data"</span>
<span class="kw"><a href="../reference/Needed.html">Needed</a></span>(Atlantic_mackerel)
<span class="co">#&gt;  [1] "BK_CC: CAA"              "BK_ML: CAL"             </span>
<span class="co">#&gt;  [3] "CompSRA: CAA"            "CompSRA4010: CAA"       </span>
<span class="co">#&gt;  [5] "DBSRA_ML: CAL"           "DCAC_ML: CAL"           </span>
<span class="co">#&gt;  [7] "Fdem_CC: CAA"            "Fdem_ML: CAL"           </span>
<span class="co">#&gt;  [9] "FMSYref: OM"             "FMSYref50: OM"          </span>
<span class="co">#&gt; [11] "FMSYref75: OM"           "Fratio_CC: CAA"         </span>
<span class="co">#&gt; [13] "Fratio_ML: CAL"          "GB_CC: Cref"            </span>
<span class="co">#&gt; [15] "GB_target: Cref, Iref"   "IT10: Iref, MPrec"      </span>
<span class="co">#&gt; [17] "IT5: Iref, MPrec"        "ITM: Iref, MPrec"       </span>
<span class="co">#&gt; [19] "L95target: ML"           "LBSPR_ItTAC: CAL, MPrec"</span>
<span class="co">#&gt; [21] "LstepCC1: MPrec, ML"     "LstepCC4: MPrec, ML"    </span>
<span class="co">#&gt; [23] "Ltarget1: ML"            "Ltarget4: ML"           </span>
<span class="co">#&gt; [25] "SBT2: Rec, Cref"         "SPSRA_ML: CAL"          </span>
<span class="co">#&gt; [27] "VPA: CAA"                "YPR_CC: CAA"            </span>
<span class="co">#&gt; [29] "YPR_ML: CAL"             "DDes: MPeff"            </span>
<span class="co">#&gt; [31] "ITe10: Iref, MPeff"      "ITe5: Iref, MPeff"      </span>
<span class="co">#&gt; [33] "LBSPR_ItEff: CAL, MPeff" "LBSPR_ItSel: CAL"       </span>
<span class="co">#&gt; [35] "LstepCE1: MPeff, ML"     "LstepCE2: MPeff, ML"    </span>
<span class="co">#&gt; [37] "LtargetE1: MPeff, ML"    "LtargetE4: MPeff, ML"</span></code></pre></div>
<p>Spatial MPs and length-vulnerability MPs (class <code>DLM_input</code>) can be MSE tested but are a management recommendation in themselves. <code>DLM_output</code> MPs however can be calculate:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Atlantic_mackerel &lt;-<span class="st"> </span><span class="kw"><a href="../reference/TAC.html">TAC</a></span>(Atlantic_mackerel,<span class="dt">reps=</span><span class="dv">48</span>)</code></pre></div>
<p>and plotted using <code>getTAC()</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(Atlantic_mackerel)</code></pre></div>
<p><img src="DLMtool_files/figure-html/unnamed-chunk-51-1.png" width="576"></p>
</div>
</div>
<div id="limitations" class="section level1">
<h1>Limitations</h1>
<div id="idealised-observation-models-for-catch-composition-data" class="section level2">
<h2>Idealised observation models for catch composition data</h2>
<p>Currently, DLMtool simulates catch-composition data from the true simulated catch composition data via a multinomial distribution and some effective sample size. This observation model may be unrealistically well-behaved and favour those approaches that use these data. We (and by that I mean Adrian) is adding a growth-type-group model to improve the realism of simulated length composition data.</p>
</div>
<div id="harvest-control-rules-must-be-integrated-into-data-limited-mps" class="section level2">
<h2>Harvest control rules must be integrated into data-limited MPs</h2>
<p>In this version of DLMtool, harvest control rules (e.g.&nbsp;the 40-10 rule) must be written into a data-limited MP. There is currently no ability to do a factorial comparison of say 4 harvest controls rules against 3 MPs (the user must describe all 12 combinations). The reason for this is that it would require further subclasses. For example the 40-10 rule may be appropriate for the output of DBSRA but it would not be appropriate for some of the simple management procedures such as DynF that already incorporate throttling of TAC recommendations according to stock depletion.</p>
</div>
<div id="natural-mortality-rate-at-age" class="section level2">
<h2>Natural mortality rate at age</h2>
<p>The current simulation assumes constant M with age. Age-specific M will be added soon.</p>
</div>
<div id="ontogenetic-habitat-shifts" class="section level2">
<h2>Ontogenetic habitat shifts</h2>
<p>Since the operating model simulated two areas, it is possible to prescribe a log-linear model that moves fish from one area to the other as they grow older. This could be used to simulate the ontogenetic shift of groupers from near shore waters to offshore reefs. Currently this feature is in development.</p>
</div>
<div id="implementation-error" class="section level2">
<h2>Implementation error</h2>
<p>In this edition of DLMtool there is no implementation error. The only imperfection between a management recommendation and the simulated TAC comes in the form of the MaxF argument that limits the maximum fishing mortality rate on any given age-class in the operating model. The default is 0.8 which is high for all but the shortest living fish species.</p>
</div>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<p>Carruthers, T.R., Punt, A.E., Walters, C.J., MacCall, A., McAllister, M.K., Dick, E.J., Cope, J. 2014. Evaluating methods for setting catch-limits in data-limited fisheries. Fisheries Research. 153, 48-68.</p>
<p>Carruthers, T.R., Kell, L., Butterworth, D., Maunder, M., Geromont, H., Walters, C., McAllister, M., Hillary, R., Kitakado, T., Davies, C. 2015. Performance review of simple management procedures. ICES journal, in press.</p>
<p>Costello, C., Ovando, D., Hilborn, R., Gains, S.D., Deschenes, O., Lester, S.E., 2012. Status and solutions for the world&rsquo;s unassessed fisheries. Science. 338, 517-520. Deriso, R. B., 1980. Harvesting Strategies and Parameter Estimation for an Age-Structured Model. Can. J. Fish. Aquat. Sci. 37, 268-282.</p>
<p>Dick, E.J., MacCall, A.D., 2011. Depletion-Based Stock Reduction Analysis: A catch-based method for determining sustainable yields for data-poor fish stocks. Fish. Res. 110, 331-341.</p>
<p>Geromont, H.F. and Butterworth, D.S. 2014. Complex assessment or simple management procedures for efficient fisheries management: a comparative study. ICES J. Mar. Sci.</p>
<p>MacCall, A.D., 2009. Depletion-corrected average catch: a simple formula for estimating sustainable yields in data-poor situations. ICES J. Mar. Sci. 66, 2267-2271.</p>
<p>Newman, D., Berkson, J., Suatoni, L. 2014. Current methods for setting catch limits for data-limited fish stocks in the United States. Fish. Res. 164, 86-93.</p>
<p>Restrepo, V.R., Thompson, G.G., Mace, P.M., Gabriel, W.L., Low, L.L., MacCall, A.D., Methot, R.D., Powers, J.E., Taylor, B.L., Wade, P.R., Witzig, J.F.,1998. Technical Guidance On the Use of Precautionary Approaches to Implementing National Standard 1 of the Magnuson-Stevens Fishery Conservation and Management Act. NOAA Technical Memorandum NMFS-F/SPO-31. 54 pp.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked"><li><a href="#introduction">Introduction</a></li>
      <li><a href="#version-notes">Version Notes</a><ul class="nav nav-pills nav-stacked"><li><a href="#new-additions-to-this-version-3.2.2">New Additions to this Version (3.2.2)</a></li>
      <li><a href="#new-additions-to-version-3.2.1">New Additions to Version 3.2.1</a></li>
      <li><a href="#new-additions-to-version-3.2">New Additions to Version 3.2</a></li>
      <li><a href="#notes-from-version-3.1">Notes from version 3.1</a></li>
      <li><a href="#a-note-on-version-2.11">A note on version 2.11</a></li>
      <li><a href="#a-note-on-bug-fixes-in-2.1.1-and-2.1.2">A note on bug fixes in 2.1.1 and 2.1.2</a></li>
      <li><a href="#a-note-on-version-2.1">A note on version 2.1</a></li>
      <li><a href="#new-to-version-2.1">New to version 2.1</a></li>
      <li><a href="#new-to-version-2.0">New to version 2.0</a></li>
      <li><a href="#coming-soon-to-v3.02">Coming soon to v3.02</a></li>
      </ul></li>
      <li><a href="#prerequisites">Prerequisites</a><ul class="nav nav-pills nav-stacked"><li><a href="#loading-the-library">Loading the library</a></li>
      <li><a href="#unpacking-the-data">Unpacking the data</a></li>
      <li><a href="#exporting-all-data-and-objects-to-the-cluster">Exporting all data and objects to the cluster</a></li>
      <li><a href="#set-a-random-seed">Set a random seed</a></li>
      </ul></li>
      <li><a href="#quick-start">Quick start</a><ul class="nav nav-pills nav-stacked"><li><a href="#define-an-operating-model">Define an operating model</a></li>
      <li><a href="#define-a-subset-of-data-limited-mps">Define a subset of data-limited MPs</a></li>
      <li><a href="#run-an-mse-and-plot-results">Run an MSE and plot results</a></li>
      <li><a href="#applying-mps-to-real-data">Applying MPs to real data</a></li>
      <li><a href="#conduct-a-sensitivity-analysis">Conduct a sensitivity analysis</a></li>
      </ul></li>
      <li><a href="#from-mse-to-management-recommendations">From MSE to management recommendations</a><ul class="nav nav-pills nav-stacked"><li><a href="#building-an-appropriate-operating-model">Building an appropriate operating model</a></li>
      <li><a href="#mse-evaluation-of-methods">MSE evaluation of methods</a></li>
      <li><a href="#value-of-information-analysis">Value of information analysis</a></li>
      <li><a href="#applying-mps-to-our-real-data">Applying MPs to our real data</a></li>
      <li><a href="#what-have-we-learned">What have we learned?</a></li>
      </ul></li>
      <li><a href="#designing-new-methods">Designing new methods</a><ul class="nav nav-pills nav-stacked"><li><a href="#average-historical-catch-mp">Average historical catch MP</a></li>
      <li><a href="#third-highest-catch">Third-highest catch</a></li>
      <li><a href="#length-at-selection-set-equal-to-length-at-maturity">Length-at-selection set equal to length-at-maturity</a></li>
      <li><a href="#reducing-fishing-rate-in-area-1-by-50-per-cent">Reducing fishing rate in area 1 by 50 per cent</a></li>
      <li><a href="#applying-the-new-mps">Applying the new MPs</a></li>
      </ul></li>
      <li><a href="#managing-real-data">Managing real data</a><ul class="nav nav-pills nav-stacked"><li><a href="#importing-data">Importing data</a></li>
      <li><a href="#populating-a-dlm_data-object-in-r">Populating a <code>DLM_data</code> object in R</a></li>
      <li><a href="#working-with-dlm_data-objects">Working with <code>DLM_data</code> objects</a></li>
      </ul></li>
      <li><a href="#limitations">Limitations</a><ul class="nav nav-pills nav-stacked"><li><a href="#idealised-observation-models-for-catch-composition-data">Idealised observation models for catch composition data</a></li>
      <li><a href="#harvest-control-rules-must-be-integrated-into-data-limited-mps">Harvest control rules must be integrated into data-limited MPs</a></li>
      <li><a href="#natural-mortality-rate-at-age">Natural mortality rate at age</a></li>
      <li><a href="#ontogenetic-habitat-shifts">Ontogenetic habitat shifts</a></li>
      <li><a href="#implementation-error">Implementation error</a></li>
      </ul></li>
      <li><a href="#references">References</a></li>
      </ul></div>
      </div>

</div>


      <footer><p>Built by <a href="http://hadley.github.io/pkgdown/">pkgdown</a>. Styled with <a href="http://getbootstrap.com">Bootstrap 3</a>.</p>
      </footer></div>

  </body></html>
